import{r as c,j as e}from"./vendor-RJ-jBvc8.js";import{u as W,a as O,b as M,c as F,s as U}from"./index-CJN2Yibc.js";import{B as m}from"./button-eI2RqdAi.js";import{A as V,M as H}from"./alert-modal-B2U6henB.js";import{u as B,T as Y}from"./i18n-DvSS2Fqm.js";import{u as Z,L as _}from"./router-Db51iocS.js";import{T as G,P as J,E as Q,S as X,a as ee,A as te,b as ae,H as se,Z as re,c as le}from"./icons-CewslWSu.js";import{I as R}from"./input-BQh-um8q.js";import{S as u}from"./skeleton-eNqIbd7s.js";import"./supabase-BfAM1BYj.js";function ne({workout:r,isActive:a}){const{t}=B(),x=Z(),[g,o]=c.useState(!1),[l,p]=c.useState({isOpen:!1,type:null}),i=c.useRef(null),w=W(s=>s.archiveWorkout),b=W(s=>s.deleteWorkout),v=O(s=>s.duration),C=O(s=>s.cancelSession),N=M(s=>s.role),y=M(s=>s.hasActiveCoach),h=N==="instrutor"||N==="aluno"&&!y,S=new Date(v*1e3).toISOString().substr(14,5);c.useEffect(()=>{function s(d){i.current&&!i.current.contains(d.target)&&o(!1)}return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const f=r.completed_count||0,k=async s=>{s&&s.preventDefault();try{const{count:d,error:j}=await U.from("workout_items").select("id",{count:"exact",head:!0}).eq("workout_id",r.id);if(j)throw j;if(!d||d===0){if(!h){x(`/workout/${r.id}`,{state:{autoStart:!0}});return}x(`/workout/${r.id}/edit`);return}x(`/workout/${r.id}`,{state:{autoStart:!0}})}catch(d){console.error("[WorkoutCard] Failed to check items count:",d),x(`/workout/${r.id}`,{state:{autoStart:!0}})}};return e.jsxs("div",{className:F("bg-neutral-50 dark:bg-neutral-900 border rounded-xl p-4 flex items-center justify-between group transition-all",a?"border-emerald-500/50 bg-emerald-50 dark:bg-emerald-950/10":"border-neutral-200 dark:border-neutral-800 hover:border-emerald-500/50"),children:[e.jsx(_,{to:`/workout/${r.id}`,className:"flex-1",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[f>0&&e.jsxs("span",{className:"flex items-center gap-1 text-amber-500/80 bg-amber-500/10 px-2 py-0.5 rounded-full",children:[e.jsx(G,{className:"h-3 w-3"}),f]}),r.last_completed_at&&e.jsxs("span",{className:"text-neutral-500 text-xs flex items-center",children:[t("workouts.last_completed")," ",new Date(r.last_completed_at).toLocaleDateString(void 0,{month:"short",day:"numeric"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-lg text-neutral-900 dark:text-white group-hover:text-emerald-500 transition-colors",children:r.name}),a&&e.jsxs("div",{className:"flex items-center gap-1.5 ml-1",children:[e.jsx("span",{className:"flex h-2 w-2 rounded-full bg-emerald-500 animate-pulse",title:t("workouts.in_progress")}),e.jsx("span",{className:"text-emerald-500 font-mono font-bold text-sm tracking-tighter",children:S})]})]}),e.jsx("div",{className:"flex gap-2 text-sm",children:e.jsx("span",{className:"text-neutral-600 dark:text-neutral-400 bg-neutral-100 dark:bg-neutral-800 px-2 py-0.5 rounded-full w-fit",children:r.focus})})]})}),e.jsxs("div",{className:"flex items-center gap-2 relative",ref:i,children:[e.jsxs(m,{size:"icon",className:"h-10 w-10 bg-emerald-600 hover:bg-emerald-700 text-white rounded-full shadow-md shadow-emerald-900/20",onClick:k,children:[e.jsx(J,{className:"h-4 w-4 ml-0.5"}),e.jsx("span",{className:"sr-only",children:t("workouts.start_workout")})]}),(h||a)&&e.jsxs("div",{className:"relative",children:[e.jsx(m,{variant:"ghost",size:"icon",className:F("h-8 w-8 text-neutral-400 hover:text-neutral-900 dark:hover:text-white transition-colors",g&&"text-neutral-900 dark:text-white bg-neutral-100 dark:bg-neutral-800"),onClick:s=>{s.preventDefault(),o(!g)},children:e.jsx(Q,{className:"h-4 w-4"})}),g&&e.jsxs("div",{className:"absolute right-0 bottom-full mb-2 w-48 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-xl shadow-xl z-50 overflow-hidden animate-in fade-in slide-in-from-bottom-2 duration-200",children:[a&&e.jsxs("button",{className:"flex items-center gap-2 w-full p-3 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors",onClick:()=>{p({isOpen:!0,type:"cancel"}),o(!1)},children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:t("workouts.cancel_active","Cancel Workout")})]}),h&&e.jsxs(e.Fragment,{children:[e.jsxs(_,{to:`/workout/${r.id}/edit`,className:"flex items-center gap-2 w-full p-3 text-sm text-neutral-700 dark:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors",onClick:()=>o(!1),children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:t("workouts.edit")})]}),e.jsxs("button",{className:"flex items-center gap-2 w-full p-3 text-sm text-neutral-700 dark:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors",onClick:()=>{p({isOpen:!0,type:"archive"}),o(!1)},children:[e.jsx(te,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{children:t("workouts.archive")})]}),e.jsxs("button",{className:"flex items-center gap-2 w-full p-3 text-sm text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors border-t border-neutral-100 dark:border-neutral-700/50",onClick:()=>{p({isOpen:!0,type:"delete"}),o(!1)},children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:t("common.delete")})]})]})]})]})]}),e.jsx(V,{isOpen:l.isOpen,onClose:()=>p({isOpen:!1,type:null}),onConfirm:()=>{l.type==="archive"&&w(r.id),l.type==="delete"&&b(r.id),l.type==="cancel"&&C()},variant:l.type==="delete"||l.type==="cancel"?"danger":"warning",title:l.type==="archive"?t("workouts.archive_title"):l.type==="delete"?t("workouts.delete_title"):t("workouts.cancel_active_title"),description:l.type==="archive"?t("workouts.archive_desc"):l.type==="delete"?t("workouts.delete_desc_full"):t("workouts.cancel_active_desc"),confirmLabel:l.type==="archive"?t("workouts.archive_confirm"):l.type==="delete"?t("common.delete"):t("workouts.cancel_active_confirm")})]})}function be(){var $,A,D,I,P;const r=Z(),{t:a}=B(),{user:t,role:x,hasActiveCoach:g}=M(),{workouts:o,fetchWorkouts:l,createWorkout:p,lastSession:i,isLoading:w}=W(),{currentSession:b,resumeSession:v,duration:C,hasNotifiedLongWorkout:N,setHasNotifiedLongWorkout:y}=O(),h=x==="instrutor"||x==="aluno"&&!g,[S,f]=c.useState(!1),[k,s]=c.useState(""),[d,j]=c.useState(""),[z,L]=c.useState(""),[E,T]=c.useState(!1);c.useEffect(()=>{l(),v()},[l,v]);const K=async n=>{if(n.preventDefault(),!k||!d)return;T(!0);const q=await p(k,d,z);q&&r(`workout/${q}/edit`),T(!1),f(!1),s(""),j(""),L("")};return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-neutral-950 pb-20 transition-colors",children:[e.jsxs("header",{className:"p-4 flex items-center justify-between sticky top-0 bg-white/80 dark:bg-neutral-950/80 backdrop-blur-md z-10 border-b border-neutral-200 dark:border-neutral-800",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-neutral-900 dark:text-white",children:a("home.greeting",{name:(($=t==null?void 0:t.user_metadata)==null?void 0:$.full_name)||((A=t==null?void 0:t.email)==null?void 0:A.split("@")[0])})}),e.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:a("home.ready")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{to:"/history",children:e.jsx(m,{size:"icon",variant:"ghost",className:"rounded-full text-neutral-500 dark:text-neutral-400 hover:text-emerald-500 hover:bg-emerald-500/10",children:e.jsx(se,{className:"h-5 w-5"})})}),e.jsx(_,{to:"/profile",children:e.jsx(m,{size:"icon",variant:"ghost",className:"rounded-full",children:e.jsx("div",{className:"h-8 w-8 bg-neutral-100 dark:bg-neutral-800 rounded-full flex items-center justify-center text-sm font-semibold text-neutral-900 dark:text-neutral-50 transition-colors",children:(((I=(D=t==null?void 0:t.user_metadata)==null?void 0:D.full_name)==null?void 0:I[0])||((P=t==null?void 0:t.email)==null?void 0:P[0])||"?").toUpperCase()})})})]})]}),e.jsxs("main",{className:"p-4 space-y-6",children:[w&&!i?e.jsxs("div",{className:"space-y-3",children:[e.jsx(u,{className:"h-4 w-32 px-1"}),e.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl p-4 flex items-center gap-4",children:[e.jsx(u,{className:"h-12 w-12 rounded-xl"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(u,{className:"h-4 w-3/4"}),e.jsx(u,{className:"h-3 w-1/2"})]})]})]}):i&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-bold text-neutral-400 dark:text-neutral-500 uppercase tracking-wider px-1",children:a("home.last_activity")}),e.jsx("div",{className:"bg-emerald-500/5 border border-emerald-500/10 rounded-2xl p-4 flex items-center justify-between transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 bg-emerald-500/20 rounded-xl flex items-center justify-center text-emerald-500",children:e.jsx(re,{className:"h-6 w-6 fill-current opacity-80"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:e.jsxs(Y,{i18nKey:"home.last_activity_text",values:{workout:i.workout_name_snapshot},children:["You trained ",e.jsx("span",{className:"text-emerald-500 font-semibold",children:i.workout_name_snapshot})]})}),e.jsxs("p",{className:"text-xs text-neutral-400 dark:text-neutral-600 mt-0.5",children:[i.workout_focus_snapshot," â€¢ ",a("home.duration",{minutes:Math.round((i.duration_seconds||0)/60)})]})]})]})})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-white",children:a("home.workouts")})}),w&&o.length===0?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(n=>e.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl p-4 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{className:"h-6 w-32"}),e.jsx(u,{className:"h-8 w-8 rounded-full"})]}),e.jsx(u,{className:"h-4 w-24"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{className:"h-4 w-12 rounded-full"}),e.jsx(u,{className:"h-4 w-12 rounded-full"})]})]},n))}):o.length===0?e.jsxs("div",{className:"text-center py-10 border border-dashed border-neutral-200 dark:border-neutral-800 rounded-xl",children:[e.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:a("home.no_workouts")}),h?e.jsx(m,{variant:"outline",onClick:()=>f(!0),children:a("home.create_first")}):e.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:a("home.student_no_workouts")})]}):e.jsx("div",{className:"space-y-3",children:o.map(n=>e.jsx(ne,{workout:n,isActive:(b==null?void 0:b.workout_id)===n.id},n.id))})]}),h&&e.jsx(m,{onClick:()=>f(!0),size:"icon",className:"fixed bottom-6 right-6 h-14 w-14 rounded-full shadow-2xl bg-emerald-600 hover:bg-emerald-700 hover:scale-110 active:scale-95 transition-all text-white border-none z-50 ring-offset-white dark:ring-offset-neutral-950 shadow-emerald-500/20",children:e.jsx(le,{className:"h-7 w-7"})}),h&&e.jsx(H,{isOpen:S,onClose:()=>f(!1),title:a("home.create_modal_title"),children:e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-neutral-900 dark:text-neutral-200",children:a("common.name")}),e.jsx(R,{value:k,onChange:n=>s(n.target.value),placeholder:a("common.name"),required:!0,className:"bg-neutral-50 dark:bg-neutral-900 border-neutral-200 dark:border-neutral-800 text-neutral-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-neutral-900 dark:text-neutral-200",children:a("home.focus")}),e.jsx(R,{value:d,onChange:n=>j(n.target.value),placeholder:a("home.focus"),required:!0,className:"bg-neutral-50 dark:bg-neutral-900 border-neutral-200 dark:border-neutral-800 text-neutral-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 text-neutral-900 dark:text-neutral-200",children:[a("common.notes")," (",a("common.optional"),")"]}),e.jsx("textarea",{className:"flex w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-neutral-50 dark:bg-neutral-900 px-3 py-2 text-sm ring-offset-white dark:ring-offset-neutral-950 placeholder:text-neutral-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 text-neutral-900 dark:text-neutral-50 h-20 resize-none",value:z,onChange:n=>L(n.target.value),placeholder:a("home.notes_placeholder")})]}),e.jsx("div",{className:"pt-2",children:e.jsx(m,{type:"submit",className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white",disabled:E,children:a(E?"common.loading":"common.create")})})]})}),e.jsx(H,{isOpen:!!b&&C>=3600&&!N,onClose:()=>y(!0),title:a("session.long_workout_notification"),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:a("session.long_workout_modal_desc")}),e.jsx(m,{className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>y(!0),children:a("common.save")})]})})]})}export{be as default};
