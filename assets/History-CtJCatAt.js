import{d as p,r as j,j as e}from"./vendor-RJ-jBvc8.js";import{b as f,s as m}from"./index-BkJioSix.js";import{B as N}from"./button-A5TMhsQL.js";import{S as i}from"./skeleton-DZpmyrWR.js";import{u as b}from"./i18n-DvSS2Fqm.js";import{f as u}from"./date-CBpsKyOP.js";import{h as g,T as k,j as w,g as y}from"./icons-C8fbylrd.js";import{u as v}from"./router-DrPDuPhB.js";import"./supabase-BfAM1BYj.js";const _=p(n=>({sessions:[],isLoading:!1,error:null,fetchHistory:async()=>{n({isLoading:!0,error:null});try{const d=f.getState().user;if(!d)throw new Error("User not authenticated");const{data:l,error:o}=await m.from("workout_sessions").select("*").eq("user_id",d.id).eq("status","finished").order("ended_at",{ascending:!1});if(o)throw o;if(!l||l.length===0){n({sessions:[]});return}const x=l.map(s=>s.id),{data:c,error:r}=await m.from("session_items").select("*").in("session_id",x).order("order_index");if(r)throw r;const a={};c==null||c.forEach(s=>{a[s.session_id]||(a[s.session_id]=[]),a[s.session_id].push(s)});const t=l.map(s=>({...s,items:a[s.id]||[]}));n({sessions:t})}catch(d){n({error:d.message})}finally{n({isLoading:!1})}}}));function z(){const{t:n}=b(),d=v(),{sessions:l,fetchHistory:o,isLoading:x}=_();j.useEffect(()=>{o()},[o]);const c=l.reduce((r,a)=>{const t=u(new Date(a.ended_at),"MMMM yyyy");return r[t]||(r[t]=[]),r[t].push(a),r},{});return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-neutral-950 pb-10 transition-colors",children:[e.jsxs("header",{className:"p-4 flex items-center gap-4 sticky top-0 bg-white/80 dark:bg-neutral-950/80 backdrop-blur-md z-10 border-b border-neutral-200 dark:border-neutral-800",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>d(-1),className:"text-neutral-500 dark:text-neutral-400",children:e.jsx(g,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-xl font-bold text-neutral-900 dark:text-white",children:n("history.title")})]}),e.jsx("main",{className:"p-4 space-y-8",children:x&&l.length===0?e.jsx("div",{className:"space-y-6",children:[1,2].map(r=>e.jsxs("div",{className:"space-y-4",children:[e.jsx(i,{className:"h-4 w-32 px-1"}),e.jsx("div",{className:"space-y-3",children:[1,2].map(a=>e.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"h-6 w-40"}),e.jsx(i,{className:"h-4 w-24"})]}),e.jsx(i,{className:"h-6 w-20 rounded-full"})]}),e.jsxs("div",{className:"pt-4 border-t border-neutral-200 dark:border-neutral-800 space-y-2",children:[e.jsx(i,{className:"h-4 w-full"}),e.jsx(i,{className:"h-4 w-3/4"})]})]},a))})]},r))}):l.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx(k,{className:"h-12 w-12 text-neutral-200 dark:text-neutral-800 mx-auto mb-4"}),e.jsx("p",{className:"text-neutral-500 dark:text-neutral-400",children:n("history.no_sessions")})]}):Object.entries(c).map(([r,a])=>e.jsxs("section",{className:"space-y-4",children:[e.jsx("h2",{className:"text-sm font-bold text-emerald-500 uppercase tracking-wider px-1",children:r}),e.jsx("div",{className:"space-y-3",children:a.map(t=>e.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-xl p-4 transition-all hover:border-emerald-500/30",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-neutral-900 dark:text-white",children:t.workout_name_snapshot}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-neutral-500 dark:text-neutral-400 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"h-3 w-3"}),u(new Date(t.ended_at),"EEE, MMM d")]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"h-3 w-3"}),Math.round((t.duration_seconds||0)/60)," min"]})]})]}),e.jsx("span",{className:"text-xs bg-neutral-100 dark:bg-neutral-800 text-neutral-600 dark:text-neutral-300 px-2 py-1 rounded-full border border-neutral-200 dark:border-neutral-700",children:t.workout_focus_snapshot})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-neutral-200 dark:border-neutral-800 space-y-2",children:[t.items.map((s,h)=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-neutral-400 dark:text-neutral-500 w-4 text-[10px]",children:[h+1,"."]}),e.jsx("span",{className:s.is_done?"text-neutral-700 dark:text-neutral-200":"text-neutral-400 dark:text-neutral-500 italic",children:s.title_snapshot})]}),e.jsxs("div",{className:"ml-6 mt-1 text-neutral-500 dark:text-neutral-400 font-mono text-xs",children:[s.weight??"-","kg ",e.jsx("span",{className:"mx-1 text-neutral-300 dark:text-neutral-600",children:"x"})," ",s.sets??"-"," ",n("common.sets").toLowerCase()," ",e.jsx("span",{className:"mx-1 text-neutral-300 dark:text-neutral-600",children:"x"})," ",s.reps??"-"," ",n("common.reps").toLowerCase()]})]},s.id)),t.items.length===0&&e.jsx("p",{className:"text-xs text-neutral-400 dark:text-neutral-600 italic",children:"No exercises logged."})]})]},t.id))})]},r))})]})}export{z as default};
