const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-Cn9cjhIG.js","assets/vendor-RJ-jBvc8.js","assets/button-BN3Rn6AQ.js","assets/alert-modal-C0rStz1h.js","assets/icons-C8fbylrd.js","assets/i18n-DvSS2Fqm.js","assets/router-DrPDuPhB.js","assets/input-BJp3yCMu.js","assets/skeleton-BnRvzEm3.js","assets/supabase-BfAM1BYj.js","assets/Login-uc7NMrRA.js","assets/Register-Ssn-NSpx.js","assets/RegisterConfirmation-zhbbtqCj.js","assets/WorkoutSession-9HwA7Jda.js","assets/WorkoutEditor-DoHvEoe9.js","assets/History-DRnR0IJp.js","assets/date-CBpsKyOP.js","assets/ArchivedWorkouts-BfvQzUjQ.js","assets/ForgotPassword-egXRfRcn.js","assets/ResetPassword-CoVJScvh.js","assets/Profile-w4iPGMdd.js"])))=>i.map(i=>d[i]);
import{t as N,b as j,d as v,p as S,e as I,j as l,r as h,f as T}from"./vendor-RJ-jBvc8.js";import{i as D,B as A,a as C,u as b}from"./i18n-DvSS2Fqm.js";import{c as O}from"./supabase-BfAM1BYj.js";import{N as k,O as P,R,a as p,H as Q}from"./router-DrPDuPhB.js";import{W as z}from"./icons-C8fbylrd.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(t){if(t.ep)return;t.ep=!0;const o=n(t);fetch(t.href,o)}})();const V={loading:"Loading...",save:"Save",cancel:"Cancel",edit:"Edit",delete:"Delete",create:"Create",name:"Name",notes:"Notes",video_url:"Video link",video_url_invalid:"Use http:// or https://",add:"Add",weight:"Weight",sets:"Sets",rest:"Rest",rest_seconds:"Rest (seconds)",reps:"Reps",email:"Email",password:"Password",logout:"Sign Out",optional:"Optional",ok:"OK",status:{offline:"Offline",syncing:"Syncing..."}},F={login:{title:"Login",subtitle:"Welcome back to OnlyTraining",email:"Email address",password:"Password",submit:"Sign In",forgot_password_link:"Forgot your password?",no_account:"Don't have an account? Register"},forgot_password:{title:"Forgot Password?",subtitle:"Enter your email to receive a reset link",submit:"Send Link",success:"Link sent! Please check your email.",back_to_login:"Back to Login"},reset_password:{title:"New Password",subtitle:"Choose a strong password for your security",new_password:"New Password",confirm_password:"Confirm New Password",submit:"Reset Password",success:"Password reset successfully!",error:"Error resetting password. Please try again."},register:{title:"Create Account",subtitle:"Start your journey today",name:"Full Name",email:"Email address",password:"Password",confirm_password:"Confirm Password",submit:"Create Account",has_account:"Already have an account? Login"}},U={greeting:"Hello, {{name}}",ready:"Ready to train?",last_activity:"Last Activity",last_activity_text:"You trained <1>{{workout}}</1>",duration:"{{minutes}} min",workouts:"Your Workouts",no_workouts:"No workouts found.",create_first:"Create your first workout",create_modal_title:"Create New Workout",focus:"Focus (e.g., Chest & Triceps)",notes_placeholder:"Any special instructions..."},H={archived:"Archived Workouts",count:"{{count}} workout",count_plural:"{{count}} workouts",archive_empty_title:"Archive Empty",archive_empty_desc:"Your archived workouts will appear here.",unarchive_title:"Unarchive Workout?",unarchive_desc:"This workout will appear back in your main list on Home. Do you want to continue?",delete_title:"Delete Workout?",delete_desc:"This action will remove the workout and all its history permanently. This cannot be undone.",delete_desc_full:"This action cannot be undone. The workout and its history will be permanently removed.",edit:"Edit Workout",archive:"Archive Workout",archive_title:"Archive Workout?",archive_desc:"This workout will be moved to the archive and will no longer appear on the Home. You can restore it later.",archive_confirm:"Archive",last_completed:"Last:",in_progress:"In Progress",start_workout:"Start Workout",no_items:"No exercises yet",cancel_active:"Cancel Workout",cancel_active_title:"Cancel active workout?",cancel_active_desc:"This will discard the current active session and its data.",cancel_active_confirm:"Cancel workout"},M={title:"History",no_sessions:"No sessions found yet. Go train!",total_duration:"Total Duration",volume_short:"kg"},Y={title:"Profile",account:"Account Information",verified:"Verified",not_verified:"Not Verified",security:"Security",reset_password:"Reset Password",settings:"App Settings",theme:"Theme",language:"Language",stats:"Statistics",system:"System",verification_status:"Verification Status",verification_desc:"Identity confirmation",password_label:"Password",password_desc:"Reset your access password",reset_email_sent_title:"Email Sent",reset_email_sent_desc:"Check your inbox to reset your password.",reset_password_sent:"Email Sent",reset_error_title:"Error Resetting"},J={title:"Edit {{name}}",exercises:"Exercises",add_exercise:"Add Exercise",exercise_title:"Exercise Title",reps:"Reps",order:"Order",preparing:"Preparing editor..."},$={active:"Active Workout",not_started:"Workout not started",finish:"Finish Workout",next:"Next Exercise",done:"Done",notes:"Instructional Notes",target:"Target",conflict:{title:"Active Workout Found",description:"You have an active session for <1>{{workout}}</1>.",question:"Do you want to discard it and start this new workout, or resume the active one?",resume:"Resume {{workout}}",discard:"Discard & Start New"},empty_help:"If you recently added exercises to this workout, this session might be using an old snapshot. Discarding it will let you start a fresh one.",finish_hint:"Complete at least {{count}} exercises to finish ({{current}}/{{count}})",finish_modal_title:"Finish Workout?",finish_modal_desc:"Great job! You've been training for <1>{{formattedTime}}</1>.",keep_training:"Keep Training",start_rest:"Start rest",rest_running:"Rest {{seconds}}s",rest_done_title:"Rest complete",rest_done_desc:"Time to start another set for {{exercise}}.",discard_modal_title:"Discard Session?",discard_modal_desc:"Are you sure you want to discard this session? All currently recorded data will be lost.",long_workout_notification:"Your workout has been going on for over 1 hour!",long_workout_modal_desc:"You've been training for over an hour. Remember to stay hydrated and rest if needed!",continue_training:"Continue training",finish_workout:"Finish workout"},B={common:V,auth:F,home:U,workouts:H,history:M,profile:Y,editor:J,session:$},K={loading:"Carregando...",save:"Salvar",cancel:"Cancelar",edit:"Editar",delete:"Excluir",create:"Criar",name:"Nome",notes:"Notas",video_url:"Link do vídeo",video_url_invalid:"Use http:// ou https://",add:"Adicionar",weight:"Peso",sets:"Séries",rest:"Descanso",rest_seconds:"Descanso (segundos)",reps:"Reps",email:"E-mail",password:"Senha",logout:"Sair",optional:"Opcional",ok:"OK",status:{offline:"Offline",syncing:"Sincronizando..."}},G={login:{title:"Login",subtitle:"Bem-vindo de volta ao OnlyTraining",email:"Endereço de e-mail",password:"Senha",submit:"Entrar",forgot_password_link:"Esqueceu sua senha?",no_account:"Não tem uma conta? Registre-se"},forgot_password:{title:"Esqueceu a senha?",subtitle:"Digite seu e-mail para receber um link de redefinição",submit:"Enviar Link",success:"Link enviado! Verifique seu e-mail.",back_to_login:"Voltar para o Login"},reset_password:{title:"Nova Senha",subtitle:"Escolha uma senha forte para sua segurança",new_password:"Nova Senha",confirm_password:"Confirmar Nova Senha",submit:"Redefinir Senha",success:"Senha redefinida com sucesso!",error:"Erro ao redefinir senha. Tente novamente."},register:{title:"Criar Conta",subtitle:"Comece sua jornada hoje",name:"Nome Completo",email:"Endereço de e-mail",password:"Senha",confirm_password:"Confirmar Senha",submit:"Criar Conta",has_account:"Já tem uma conta? Login"}},Z={greeting:"Olá, {{name}}",ready:"Pronto para treinar?",last_activity:"Última Atividade",last_activity_text:"Você treinou <1>{{workout}}</1>",duration:"{{minutes}} min",workouts:"Seus Treinos",no_workouts:"Nenhum treino encontrado.",create_first:"Crie seu primeiro treino",create_modal_title:"Criar Novo Treino",focus:"Foco (ex: Peito e Tríceps)",notes_placeholder:"Qualquer instrução especial..."},X={archived:"Treinos Arquivados",count:"{{count}} treino",count_plural:"{{count}} treinos",archive_empty_title:"Arquivo Vazio",archive_empty_desc:"Seus treinos arquivados aparecerão aqui.",unarchive_title:"Reativar Treino?",unarchive_desc:"Este treino voltará a aparecer na sua lista principal na Home. Deseja continuar?",delete_title:"Excluir Treino?",delete_desc:"Esta ação removerá o treino e todo o seu histórico permanentemente. Não é possível desfazer.",delete_desc_full:"Esta ação não pode ser desfeita. O treino e seu histórico serão removidos permanentemente.",edit:"Editar Treino",archive:"Arquivar Treino",archive_title:"Arquivar Treino?",archive_desc:"Este treino será movido para o arquivo e não aparecerá mais na Home. Você pode restaurá-lo depois.",archive_confirm:"Arquivar",last_completed:"Última:",in_progress:"Em andamento",start_workout:"Começar Treino",no_items:"Nenhum exercicio ainda",cancel_active:"Cancelar Treino",cancel_active_title:"Cancelar treino ativo?",cancel_active_desc:"Isso vai descartar a sessão ativa e seus dados.",cancel_active_confirm:"Cancelar treino"},ee={title:"Histórico",no_sessions:"Nenhuma sessão encontrada. Vá treinar!",total_duration:"Duração Total",volume_short:"kg"},te={title:"Perfil",account:"Informações da Conta",verified:"Verificado",not_verified:"Não Verificado",security:"Segurança",reset_password:"Redefinir Senha",settings:"Configurações do App",theme:"Tema",language:"Idioma",stats:"Estatísticas",system:"Sistema",verification_status:"Status de Verificação",verification_desc:"Confirmação de identidade",password_label:"Senha",password_desc:"Redefinir sua senha de acesso",reset_email_sent_title:"E-mail Enviado",reset_email_sent_desc:"Verifique sua caixa de entrada para redefinir sua senha.",reset_password_sent:"E-mail Enviado",reset_error_title:"Erro ao Redefinir"},oe={title:"Editar {{name}}",exercises:"Exercícios",add_exercise:"Adicionar Exercício",exercise_title:"Título do Exercício",reps:"Reps",order:"Ordem",preparing:"Preparando editor..."},re={active:"Treino Ativo",not_started:"Treino nao iniciado",finish:"Finalizar Treino",next:"Próximo Exercício",done:"Concluir",notes:"Instruções",target:"Alvo",conflict:{title:"Treino Ativo Encontrado",description:"Você já tem uma sessão ativa para <1>{{workout}}</1>.",question:"Deseja descartar a sessão anterior e começar este novo treino, ou retomar a ativa?",resume:"Retomar {{workout}}",discard:"Descartar e Começar Novo"},empty_help:"Se você adicionou exercícios recentemente, esta sessão pode estar usando uma versão antiga. Descartá-la permitirá começar uma nova com os exercícios atuais.",finish_hint:"Conclua pelo menos {{count}} exercícios para finalizar ({{current}}/{{count}})",finish_modal_title:"Finalizar Treino?",finish_modal_desc:"Bom trabalho! Você está treinando há <1>{{formattedTime}}</1>.",keep_training:"Continuar Treinando",start_rest:"Iniciar descanso",rest_running:"Descanso {{seconds}}s",rest_done_title:"Descanso concluído",rest_done_desc:"Hora de começar outra série para {{exercise}}.",discard_modal_title:"Descartar Sessão?",discard_modal_desc:"Tem certeza que deseja descartar esta sessão? Todos os dados registrados serão perdidos.",long_workout_notification:"Seu treino já dura mais de 1 hora!",long_workout_modal_desc:"Você está treinando há mais de uma hora. Lembre-se de se hidratar e descansar se necessário!",continue_training:"Continuar treinando",finish_workout:"Finalizar treino"},se={common:K,auth:G,home:Z,workouts:X,history:ee,profile:te,editor:oe,session:re};D.use(A).use(C).init({resources:{en:{translation:B},pt:{translation:se}},fallbackLng:"en",interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"]}});const ie="modulepreload",ne=function(e){return"/"+e},E={},y=function(a,n,i){let t=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),s=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));t=Promise.allSettled(n.map(u=>{if(u=ne(u),u in E)return;E[u]=!0;const c=u.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${d}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":ie,c||(f.as="script"),f.crossOrigin="",f.href=u,s&&f.setAttribute("nonce",s),document.head.appendChild(f),c)return new Promise((w,_)=>{f.addEventListener("load",w),f.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(r){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=r,window.dispatchEvent(s),!s.defaultPrevented)throw r}return t.then(r=>{for(const s of r||[])s.status==="rejected"&&o(s.reason);return a().catch(o)})},ae="https://nwkfurorlmrhwywiqpvc.supabase.co",ue="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im53a2Z1cm9ybG1yaHd5d2lxcHZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2MjExMTUsImV4cCI6MjA4NTE5NzExNX0.TmEiCa89YhOlEEcE72MhIfE0JWw2QyQz2JGI63P463s",m=O(ae,ue);function ce(...e){return N(j(e))}function L(e){if(!e)return null;const a=e.trim();if(!a)return null;try{const n=new URL(a);return n.protocol!=="http:"&&n.protocol!=="https:"?null:n.toString()}catch{return null}}const g=v(e=>({user:null,session:null,isLoading:!0,initialize:async()=>{try{const{data:{session:a}}=await m.auth.getSession();e({session:a,user:(a==null?void 0:a.user)??null,isLoading:!1}),m.auth.onAuthStateChange((n,i)=>{e({session:i,user:(i==null?void 0:i.user)??null,isLoading:!1})})}catch(a){console.error("Auth initialization error:",a),e({isLoading:!1})}},signOut:async()=>{await m.auth.signOut(),e({session:null,user:null})}})),de=v()(S((e,a)=>({workouts:[],archivedCount:0,lastSession:null,activeWorkoutItems:[],isLoading:!1,error:null,syncQueue:[],processSyncQueue:async()=>{if(!navigator.onLine||a().syncQueue.length===0)return;const n=[...a().syncQueue].sort((i,t)=>i.timestamp-t.timestamp);e({syncQueue:[]});for(const i of n)try{i.action==="archive"&&await a().archiveWorkout(i.id),i.action==="unarchive"&&await a().unarchiveWorkout(i.id),i.action==="delete"&&await a().deleteWorkout(i.id)}catch(t){console.error("Failed to sync item:",i,t),e(o=>({syncQueue:[...o.syncQueue,i]}))}},fetchWorkouts:async()=>{e({isLoading:!0,error:null});try{const n=g.getState().user;if(!n)return;const{data:i,error:t}=await m.from("workouts").select("*").eq("user_id",n.id).eq("is_archived",!1).order("created_at",{ascending:!1});if(t)throw t;const{count:o,error:r}=await m.from("workouts").select("*",{count:"exact",head:!0}).eq("user_id",n.id).eq("is_archived",!0);if(r)throw r;const{data:s,error:u}=await m.from("workout_sessions").select("*").eq("user_id",n.id).eq("status","finished").order("ended_at",{ascending:!1});if(u)throw u;const c={},d={};s==null||s.forEach(_=>{_.workout_id&&(c[_.workout_id]=(c[_.workout_id]||0)+1,!d[_.workout_id]&&_.ended_at&&(d[_.workout_id]=_.ended_at))});const f=i.map(_=>({..._,completed_count:c[_.id]||0,last_completed_at:d[_.id]})),w=s&&s.length>0?s[0]:null;e({workouts:f,lastSession:w,archivedCount:o||0})}catch(n){e({error:n.message})}finally{e({isLoading:!1})}},createWorkout:async(n,i,t)=>{e({isLoading:!0,error:null});try{const o=g.getState().user;if(!o)throw new Error("User not authenticated");const{data:r,error:s}=await m.from("workouts").insert({user_id:o.id,name:n,focus:i,notes:t}).select().single();if(s)throw s;const u=a().workouts;return e({workouts:[r,...u]}),r.id}catch(o){return e({error:o.message}),null}finally{e({isLoading:!1})}},deleteWorkout:async n=>{const i=a().workouts;if(e({workouts:i.filter(t=>t.id!==n)}),!navigator.onLine){e(t=>({syncQueue:[...t.syncQueue,{id:n,action:"delete",timestamp:Date.now()}]}));return}e({isLoading:!0,error:null});try{const t=g.getState().user;if(!t)throw new Error("User not authenticated");const{error:o}=await m.from("workouts").delete().eq("id",n).eq("user_id",t.id);if(o)throw o}catch(t){e({error:t.message,workouts:i})}finally{e({isLoading:!1})}},archiveWorkout:async n=>{const i=a().workouts;if(e({workouts:i.filter(t=>t.id!==n)}),!navigator.onLine){e(t=>({syncQueue:[...t.syncQueue,{id:n,action:"archive",timestamp:Date.now()}]}));return}e({isLoading:!0,error:null});try{const t=g.getState().user;if(!t)throw new Error("User not authenticated");const{error:o}=await m.from("workouts").update({is_archived:!0}).eq("id",n).eq("user_id",t.id);if(o)throw o}catch(t){e({error:t.message,workouts:i})}finally{e({isLoading:!1})}},unarchiveWorkout:async n=>{if(!navigator.onLine){e(i=>({syncQueue:[...i.syncQueue,{id:n,action:"unarchive",timestamp:Date.now()}]}));return}e({isLoading:!0,error:null});try{const i=g.getState().user;if(!i)throw new Error("User not authenticated");const{error:t}=await m.from("workouts").update({is_archived:!1}).eq("id",n).eq("user_id",i.id);if(t)throw t;await a().fetchWorkouts()}catch(i){e({error:i.message})}finally{e({isLoading:!1})}},fetchWorkoutItems:async n=>{e({isLoading:!0,error:null});try{const i=g.getState().user;if(!i)throw new Error("User not authenticated");const{data:t,error:o}=await m.from("workout_items").select("*").eq("workout_id",n).eq("user_id",i.id).order("order_index");if(o)throw o;e({activeWorkoutItems:t})}catch(i){e({error:i.message})}finally{e({isLoading:!1})}},addWorkoutItem:async(n,i,t,o,r,s,u,c)=>{e({isLoading:!0,error:null});try{const d=g.getState().user;if(!d)throw new Error("User not authenticated");const f=L(c),w={workout_id:n,user_id:d.id,title:i,order_index:t,default_reps:o,default_sets:r,rest_seconds:s,notes:u,...f?{video_url:f}:{}},{data:_,error:x}=await m.from("workout_items").insert(w).select().single();if(x)throw x;const W=a().activeWorkoutItems;e({activeWorkoutItems:[...W,_]})}catch(d){e({error:d.message})}finally{e({isLoading:!1})}},updateWorkoutItem:async(n,i)=>{const t=a().activeWorkoutItems;e({activeWorkoutItems:t.map(o=>o.id===n?{...o,...i}:o)});try{const o=g.getState().user;if(!o)throw new Error("User not authenticated");const r=L(i.video_url),s={...i};r?s.video_url=r:delete s.video_url;const{error:u}=await m.from("workout_items").update(s).eq("id",n).eq("user_id",o.id);if(u)throw u}catch(o){e({error:o.message,activeWorkoutItems:t})}},deleteWorkoutItem:async n=>{const i=a().activeWorkoutItems;e({activeWorkoutItems:i.filter(t=>t.id!==n)});try{const t=g.getState().user;if(!t)throw new Error("User not authenticated");const{error:o}=await m.from("workout_items").delete().eq("id",n).eq("user_id",t.id);if(o)throw o}catch(t){e({error:t.message}),e({activeWorkoutItems:i})}}}),{name:"only-training-workouts",storage:I(()=>localStorage),partialize:e=>({workouts:e.workouts,archivedCount:e.archivedCount,syncQueue:e.syncQueue})}));function le(){const{session:e,isLoading:a}=g();return a?l.jsx("div",{className:"flex items-center justify-center min-h-screen bg-white dark:bg-neutral-950 text-neutral-900 dark:text-white transition-colors",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-emerald-500"})}):e?l.jsx(P,{}):l.jsx(k,{to:"/login",replace:!0})}const me=v()(S(e=>({theme:"dark",setTheme:a=>e({theme:a}),toggleTheme:()=>e(a=>({theme:a.theme==="light"?"dark":"light"}))}),{name:"theme-storage"})),q=v()(S((e,a)=>{const n=()=>{const{intervalId:t}=a();t&&clearInterval(t),e({intervalId:null})},i=()=>{n();const t=()=>a().incrementDuration();t();const o=setInterval(t,1e3);e({intervalId:Number(o)})};return{currentSession:null,sessionItems:[],isLoading:!1,error:null,duration:0,intervalId:null,hasNotifiedLongWorkout:!1,syncQueue:[],processSyncQueue:async()=>{if(!navigator.onLine||a().syncQueue.length===0)return;const t=g.getState().user;if(!t)return;const o=[...a().syncQueue].sort((r,s)=>r.timestamp-s.timestamp);e({syncQueue:[]});for(const r of o)try{if(r.action==="toggle_done"&&await m.from("session_items").update({is_done:r.payload.isDone,done_at:r.payload.doneAt}).eq("id",r.id).eq("user_id",t.id),r.action==="update_stats"&&await m.from("session_items").update({weight:r.payload.weight,reps:r.payload.reps}).eq("id",r.id).eq("user_id",t.id),r.action==="finish_session"&&(await m.from("workout_sessions").update({status:"finished",ended_at:r.payload.endedAt,duration_seconds:r.payload.duration}).eq("id",r.id).eq("user_id",t.id),r.payload.defaultWeights&&r.payload.defaultWeights.length>0))for(const s of r.payload.defaultWeights)!s.workout_item_id||s.weight==null||await m.from("workout_items").update({default_weight:s.weight}).eq("id",s.workout_item_id).eq("user_id",t.id)}catch(s){console.error("Failed to sync session item:",r,s),e(u=>({syncQueue:[...u.syncQueue,r]}))}},resumeSession:async()=>{const t=g.getState().user;if(!t){n(),e({currentSession:null,sessionItems:[],duration:0,isLoading:!1,hasNotifiedLongWorkout:!1});return}if(!a().isLoading)try{e({isLoading:!0,error:null});const{data:o,error:r}=await m.from("workout_sessions").select("*").eq("user_id",t.id).eq("status","in_progress").order("started_at",{ascending:!1});if(r){console.error("Failed to sync session",r);return}const s=(o==null?void 0:o[0])||null;if(s){n();const{data:u}=await m.from("session_items").select("*").eq("session_id",s.id).order("order_index"),c=new Date,d=new Date(s.started_at);if(!(c.getFullYear()===d.getFullYear()&&c.getMonth()===d.getMonth()&&c.getDate()===d.getDate())){console.log("Session expired (started on previous day), auto-finalizing..."),await m.from("workout_sessions").update({status:"finished",ended_at:new Date(d.setHours(23,59,59,999)).toISOString(),duration_seconds:Math.max(0,Math.floor((new Date(d.setHours(23,59,59,999)).getTime()-d.getTime())/1e3))}).eq("id",s.id),e({currentSession:null,sessionItems:[],duration:0,hasNotifiedLongWorkout:!1});return}const w=Math.floor((c.getTime()-d.getTime())/1e3);e({currentSession:s,sessionItems:u||[],duration:w,hasNotifiedLongWorkout:w>=3600}),i()}else n(),e({currentSession:null,sessionItems:[],duration:0,hasNotifiedLongWorkout:!1})}catch(o){console.error("Failed to resume session",o)}finally{e({isLoading:!1})}},startSession:async t=>{if(a().isLoading||a().currentSession)return"error";e({isLoading:!0,error:null});try{const o=g.getState().user;if(!o)throw new Error("User not authenticated");const{data:r}=await m.from("workouts").select("*").eq("id",t).eq("user_id",o.id).maybeSingle();if(!r)throw new Error("Workout not found");const{data:s}=await m.from("workout_items").select("*").eq("workout_id",r.id).eq("user_id",o.id).order("order_index");if(!s||s.length===0)return e({isLoading:!1}),"no_items";const{data:u,error:c}=await m.from("workout_sessions").insert({user_id:o.id,workout_id:r.id,workout_name_snapshot:r.name,workout_focus_snapshot:r.focus,status:"in_progress",started_at:new Date().toISOString()}).select().single();if(c)throw c;const d=s.map(_=>({user_id:o.id,session_id:u.id,workout_item_id:_.id,title_snapshot:_.title,notes_snapshot:_.notes,video_url:_.video_url,order_index:_.order_index,weight:_.default_weight,reps:_.default_reps,sets:_.default_sets,rest_seconds:_.rest_seconds,is_done:!1})),{error:f}=await m.from("session_items").insert(d);if(f)throw f;const{data:w}=await m.from("session_items").select("*").eq("session_id",u.id).order("order_index");return e({sessionItems:w||[]}),e({currentSession:u,duration:0}),i(),"started"}catch(o){return e({error:o.message}),"error"}finally{e({isLoading:!1})}},incrementDuration:()=>{const{currentSession:t,finishSession:o}=a();if(!t)return;const r=new Date,s=new Date(t.started_at);if(!(r.getFullYear()===s.getFullYear()&&r.getMonth()===s.getMonth()&&r.getDate()===s.getDate())){console.log("Day changed, auto-finalizing session..."),o();return}const c=Math.max(0,Math.floor((r.getTime()-s.getTime())/1e3));e(d=>d.duration===c?{}:{duration:c})},toggleItemDone:async(t,o)=>{const r=g.getState().user;if(!r)return;const s=a().sessionItems.map(u=>u.id===t?{...u,is_done:o}:u);if(e({sessionItems:s}),!navigator.onLine){e(u=>({syncQueue:[...u.syncQueue.filter(c=>!(c.action==="toggle_done"&&c.id===t)),{id:t,action:"toggle_done",payload:{isDone:o,doneAt:o?new Date().toISOString():null},timestamp:Date.now()}]}));return}try{await m.from("session_items").update({is_done:o,done_at:o?new Date().toISOString():null}).eq("id",t).eq("user_id",r.id)}catch(u){console.error(u),e(c=>({syncQueue:[...c.syncQueue.filter(d=>!(d.action==="toggle_done"&&d.id===t)),{id:t,action:"toggle_done",payload:{isDone:o,doneAt:o?new Date().toISOString():null},timestamp:Date.now()}]}))}},updateItemStats:async(t,o,r)=>{const s=g.getState().user;if(!s)return;const u=a().sessionItems.map(c=>c.id===t?{...c,weight:o,reps:r}:c);if(e({sessionItems:u}),!navigator.onLine){e(c=>({syncQueue:[...c.syncQueue.filter(d=>!(d.action==="update_stats"&&d.id===t)),{id:t,action:"update_stats",payload:{weight:o,reps:r},timestamp:Date.now()}]}));return}try{await m.from("session_items").update({weight:o,reps:r}).eq("id",t).eq("user_id",s.id)}catch(c){console.error(c),e(d=>({syncQueue:[...d.syncQueue.filter(f=>!(f.action==="update_stats"&&f.id===t)),{id:t,action:"update_stats",payload:{weight:o,reps:r},timestamp:Date.now()}]}))}},finishSession:async()=>{const{currentSession:t,duration:o,intervalId:r}=a();if(!t)return;const s=g.getState().user;if(!s)return;e({isLoading:!0}),r&&n();const u=new Date().toISOString(),c=a().sessionItems.filter(d=>d.workout_item_id&&d.weight!=null).map(d=>({workout_item_id:d.workout_item_id,weight:d.weight}));if(!navigator.onLine){e(d=>({syncQueue:[...d.syncQueue.filter(f=>!(f.action==="finish_session"&&f.id===t.id)),{id:t.id,action:"finish_session",payload:{endedAt:u,duration:o,defaultWeights:c},timestamp:Date.now()}],currentSession:null,sessionItems:[],isLoading:!1}));return}try{await m.from("workout_sessions").update({status:"finished",ended_at:u,duration_seconds:o}).eq("id",t.id).eq("user_id",s.id);const{sessionItems:d}=a();for(const f of d)f.workout_item_id&&f.weight&&await m.from("workout_items").update({default_weight:f.weight}).eq("id",f.workout_item_id).eq("user_id",s.id);e({currentSession:null,sessionItems:[]})}catch(d){e({error:d.message})}finally{e({isLoading:!1})}},restartSession:async t=>{const o=g.getState().user;if(o){e({isLoading:!0,error:null}),n();try{await m.from("workout_sessions").update({status:"finished",ended_at:new Date().toISOString()}).eq("user_id",o.id).eq("status","in_progress"),e({currentSession:null,sessionItems:[],duration:0});const{data:r}=await m.from("workouts").select("*").eq("id",t).eq("user_id",o.id).single();if(!r)throw new Error("Workout not found");const{data:s,error:u}=await m.from("workout_sessions").insert({user_id:o.id,workout_id:r.id,workout_name_snapshot:r.name,workout_focus_snapshot:r.focus,status:"in_progress",started_at:new Date().toISOString()}).select().single();if(u)throw u;const{data:c}=await m.from("workout_items").select("*").eq("workout_id",r.id).eq("user_id",o.id).order("order_index");if(c&&c.length>0){const d=c.map(w=>({user_id:o.id,session_id:s.id,workout_item_id:w.id,title_snapshot:w.title,notes_snapshot:w.notes,video_url:w.video_url,order_index:w.order_index,weight:w.default_weight,reps:w.default_reps,sets:w.default_sets,rest_seconds:w.rest_seconds,is_done:!1}));await m.from("session_items").insert(d);const{data:f}=await m.from("session_items").select("*").eq("session_id",s.id).order("order_index");e({sessionItems:f||[]})}e({currentSession:s,duration:0}),i()}catch(r){console.error("[Store] restartSession failed:",r),e({error:r.message||"Failed to restart session"})}finally{e({isLoading:!1})}}},finishAllInProgressSessions:async()=>{const t=g.getState().user;if(t){e({isLoading:!0,error:null}),n();try{const{error:o}=await m.from("workout_sessions").update({status:"finished",ended_at:new Date().toISOString()}).eq("user_id",t.id).eq("status","in_progress");if(o)throw o;e({currentSession:null,sessionItems:[],duration:0})}catch(o){console.error("[Store] finishAllInProgressSessions failed:",o),e({error:o.message||"Failed to finish sessions"})}finally{e({isLoading:!1})}}},cancelSession:async(t=!1)=>{const o=g.getState().user;if(!o)return;const{currentSession:r,intervalId:s}=a();if(!(!r&&!t)){e({isLoading:!0,error:null}),s&&n();try{if(t){const{data:u}=await m.from("workout_sessions").select("id").eq("user_id",o.id).eq("status","in_progress");if(u&&u.length>0){const c=u.map(f=>f.id);await m.from("session_items").delete().in("session_id",c).eq("user_id",o.id);const{error:d}=await m.from("workout_sessions").delete().in("id",c).eq("user_id",o.id);if(d)throw d}}else if(r){const{error:u}=await m.from("session_items").delete().eq("session_id",r.id).eq("user_id",o.id);if(u)throw u;const{error:c}=await m.from("workout_sessions").delete().eq("id",r.id).eq("user_id",o.id);if(c)throw c}e({currentSession:null,sessionItems:[]})}catch(u){console.error("[Store] cancelSession failed:",u),e({error:u.message||"Failed to cancel session"})}finally{e({isLoading:!1})}}},setHasNotifiedLongWorkout:t=>{e({hasNotifiedLongWorkout:t})}}},{name:"only-training-session",storage:I(()=>localStorage),partialize:e=>({currentSession:e.currentSession,sessionItems:e.sessionItems,duration:e.duration,hasNotifiedLongWorkout:e.hasNotifiedLongWorkout,syncQueue:e.syncQueue})}));function fe(){const{t:e}=b(),{duration:a,currentSession:n,hasNotifiedLongWorkout:i,setHasNotifiedLongWorkout:t}=q(),o=h.useRef(!1);h.useEffect(()=>{!o.current&&"Notification"in window&&(Notification.permission==="default"&&Notification.requestPermission(),o.current=!0)},[]),h.useEffect(()=>{n&&a>=3600&&!i&&document.visibilityState==="hidden"&&"Notification"in window&&Notification.permission==="granted"&&(navigator.serviceWorker.ready.then(r=>{r.showNotification("OnlyTraining",{body:e("session.long_workout_notification","Seu treino j� dura mais de 1 hora!"),icon:"/favicon.png",badge:"/favicon.png",tag:"long-workout-reminder",actions:[{action:"continue",title:e("session.continue_training","Continuar treinando")},{action:"finish",title:e("session.finish_workout","Finalizar treino")}]})}),t(!0))},[a,n,i,t,e])}function _e({className:e,fullPage:a=!1,text:n="Loading..."}){const i=l.jsxs("div",{className:ce("flex flex-col items-center justify-center gap-4 animate-in fade-in duration-500",e),children:[l.jsxs("div",{className:"relative h-12 w-12",children:[l.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-emerald-500/20"}),l.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-emerald-500 border-t-transparent animate-spin"}),l.jsx("div",{className:"absolute inset-2 bg-emerald-500/20 rounded-full animate-pulse"})]}),n&&l.jsx("p",{className:"text-sm font-medium text-neutral-500 dark:text-neutral-400 animate-pulse",children:n})]});return a?l.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-white dark:bg-neutral-950",children:i}):i}const he=h.lazy(()=>y(()=>import("./Home-Cn9cjhIG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),we=h.lazy(()=>y(()=>import("./Login-uc7NMrRA.js"),__vite__mapDeps([10,1,2,7,5,4,6,9]))),ge=h.lazy(()=>y(()=>import("./Register-Ssn-NSpx.js"),__vite__mapDeps([11,1,2,7,5,4,6,9]))),pe=h.lazy(()=>y(()=>import("./RegisterConfirmation-zhbbtqCj.js"),__vite__mapDeps([12,1,2,5,4,6,9]))),ye=h.lazy(()=>y(()=>import("./WorkoutSession-9HwA7Jda.js"),__vite__mapDeps([13,1,2,7,3,4,5,6,9]))),ve=h.lazy(()=>y(()=>import("./WorkoutEditor-DoHvEoe9.js"),__vite__mapDeps([14,1,2,7,8,5,4,6,9]))),ke=h.lazy(()=>y(()=>import("./History-DRnR0IJp.js"),__vite__mapDeps([15,1,2,8,5,16,4,6,9]))),Se=h.lazy(()=>y(()=>import("./ArchivedWorkouts-BfvQzUjQ.js"),__vite__mapDeps([17,1,2,3,4,8,5,6,9]))),xe=h.lazy(()=>y(()=>import("./ForgotPassword-egXRfRcn.js"),__vite__mapDeps([18,1,2,7,5,4,6,9]))),Ee=h.lazy(()=>y(()=>import("./ResetPassword-CoVJScvh.js"),__vite__mapDeps([19,1,2,7,5,4,6,9]))),Le=h.lazy(()=>y(()=>import("./Profile-w4iPGMdd.js"),__vite__mapDeps([20,1,2,3,4,5,6,9])));function Ie(){const{t:e}=b();fe();const{initialize:a,session:n}=g(),{theme:i}=me(),{processSyncQueue:t}=de(),{finishSession:o,processSyncQueue:r}=q();h.useEffect(()=>{const c=d=>{var f;((f=d.data)==null?void 0:f.type)==="FINISH_WORKOUT"&&o()};return navigator.serviceWorker.addEventListener("message",c),()=>navigator.serviceWorker.removeEventListener("message",c)},[o]);const[s,u]=h.useState(!navigator.onLine);return h.useEffect(()=>{a()},[a]),h.useEffect(()=>{const c=()=>{u(!1),t(),r()},d=()=>u(!0);return window.addEventListener("online",c),window.addEventListener("offline",d),()=>{window.removeEventListener("online",c),window.removeEventListener("offline",d)}},[t]),h.useEffect(()=>{const c=window.document.documentElement;c.classList.remove("light","dark"),c.classList.add(i),c.style.setProperty("color-scheme",i)},[i]),l.jsxs("div",{className:"min-h-screen bg-white dark:bg-neutral-950 text-neutral-900 dark:text-white font-sans antialiased transition-colors duration-300",children:[l.jsx(h.Suspense,{fallback:l.jsx(_e,{fullPage:!0}),children:l.jsxs(R,{children:[l.jsx(p,{path:"/login",element:n?l.jsx(k,{to:"/"}):l.jsx(we,{})}),l.jsx(p,{path:"/register",element:n?l.jsx(k,{to:"/"}):l.jsx(ge,{})}),l.jsx(p,{path:"/register-confirmation",element:l.jsx(pe,{})}),l.jsx(p,{path:"/forgot-password",element:l.jsx(xe,{})}),l.jsx(p,{path:"/reset-password",element:l.jsx(Ee,{})}),l.jsxs(p,{element:l.jsx(le,{}),children:[l.jsx(p,{path:"/",element:l.jsx(he,{})}),l.jsx(p,{path:"/workout/:workoutId",element:l.jsx(ye,{})}),l.jsx(p,{path:"/workout/:workoutId/edit",element:l.jsx(ve,{})}),l.jsx(p,{path:"/history",element:l.jsx(ke,{})}),l.jsx(p,{path:"/archive",element:l.jsx(Se,{})}),l.jsx(p,{path:"/profile",element:l.jsx(Le,{})})]})]})}),s&&l.jsx("div",{className:"fixed bottom-4 left-4 right-4 bg-amber-500 text-white px-4 py-3 rounded-xl shadow-lg flex items-center justify-between z-50 animate-in slide-in-from-bottom-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(z,{className:"h-5 w-5"}),l.jsxs("div",{className:"text-sm",children:[l.jsx("p",{className:"font-bold",children:e("common.status.offline")}),l.jsxs("p",{className:"opacity-90",children:[e("home.ready")," (Offline Mode)"]})]})]})})]})}T.createRoot(document.getElementById("root")).render(l.jsx(h.StrictMode,{children:l.jsx(Q,{children:l.jsx(Ie,{})})}));export{_e as L,q as a,g as b,ce as c,me as d,L as g,m as s,de as u};
