import{r as l,j as e}from"./vendor-RJ-jBvc8.js";import{b as Ce,d as qe,u as Pe,c as re,s as i}from"./index-CJN2Yibc.js";import{B as x}from"./button-eI2RqdAi.js";import{I as _}from"./input-BQh-um8q.js";import{A as Oe,M as Le}from"./alert-modal-B2U6henB.js";import{u as Ue}from"./i18n-DvSS2Fqm.js";import{h as Re,M as Ae,l as Ie,m as le,n as Ee,A as Fe,U as Te,K as $e,o as Ge,p as Me,q as We,r as ze,L as Be}from"./icons-CewslWSu.js";import{u as De}from"./router-Db51iocS.js";import"./supabase-BfAM1BYj.js";const ne="profile-photos";function st(){var Y,Z,ee;const{t,i18n:g}=Ue(),f=De(),{user:a,signOut:ie,role:h,refreshProfileContext:oe}=Ce(),{theme:y,toggleTheme:ce}=qe(),{archivedCount:de,fetchWorkouts:E}=Pe(),[F,ue]=l.useState(!1),[T,$]=l.useState(!1),[p,G]=l.useState(null),[S,M]=l.useState(null),[me,C]=l.useState(null),[xe,W]=l.useState(!1),[z,B]=l.useState(!1),[u,D]=l.useState(!1),[m,K]=l.useState(!1),[he,q]=l.useState(!1),[P,O]=l.useState(""),[L,U]=l.useState(""),[j,R]=l.useState(""),[A,N]=l.useState(null),[v,I]=l.useState(null),[fe,H]=l.useState(""),[pe,V]=l.useState(""),[be,J]=l.useState(""),[ge,Q]=l.useState(null);l.useEffect(()=>{E()},[E]),l.useEffect(()=>{(async()=>{if(!(!a||h!=="aluno")){W(!0);try{const{data:s}=await i.from("coach_student_links").select("*").eq("student_id",a.id).eq("status","active").maybeSingle();if(G(s||null),!s){M(null),C(null);return}const[{data:n},{data:c}]=await Promise.all([i.from("profiles").select("*").eq("user_id",s.coach_id).maybeSingle(),i.from("coach_student_unlink_requests").select("*").eq("link_id",s.id).eq("status","pending").maybeSingle()]);M(n||null),C(c||null)}finally{W(!1)}}})()},[a,h]),l.useEffect(()=>{(async()=>{if(a){D(!0);try{const{data:s}=await i.from("profiles").select("*").eq("user_id",a.id).maybeSingle(),n=(s==null?void 0:s.first_name)??"",c=(s==null?void 0:s.last_name)??"",b=(s==null?void 0:s.gym_name)??"",d=(s==null?void 0:s.avatar_url)??null;O(n),U(c),R(b),N(d),H(n),V(c),J(b),Q(d)}finally{D(!1)}}})()},[a]);const[w,o]=l.useState({isOpen:!1,title:"",description:"",variant:"info"}),je=async()=>{await ie(),f("/login")},Ne=async()=>{if(a!=null&&a.email){$(!0);try{const{error:r}=await i.auth.resetPasswordForEmail(a.email,{redirectTo:`${window.location.origin}/#/login`});if(r)throw r;o({isOpen:!0,variant:"success",title:t("profile.reset_email_sent_title"),description:t("profile.reset_email_sent_desc")}),ue(!0)}catch(r){o({isOpen:!0,variant:"danger",title:t("profile.reset_error_title"),description:r.message})}finally{$(!1)}}},ve=!!(a!=null&&a.email_confirmed_at),k=[P.trim(),L.trim()].filter(Boolean).join(" ").trim()||((Y=a==null?void 0:a.user_metadata)==null?void 0:Y.full_name)||((Z=a==null?void 0:a.email)==null?void 0:Z.split("@")[0])||"",we=async()=>{if(p){B(!0);try{const{data:r,error:s}=await i.rpc("request_student_unlink",{link_id_input:p.id});if(s)throw s;r==="ended"?(await oe(),o({isOpen:!0,variant:"success",title:t("coach.student.unlinked_title"),description:t("coach.student.unlinked_desc")})):o({isOpen:!0,variant:"info",title:t("coach.student.unlink_requested_title"),description:t("coach.student.unlink_requested_desc")});const{data:n}=await i.from("coach_student_links").select("*").eq("id",p.id).maybeSingle();G(n||null);const{data:c}=await i.from("coach_student_unlink_requests").select("*").eq("link_id",p.id).eq("status","pending").maybeSingle();C(c||null)}catch(r){o({isOpen:!0,variant:"danger",title:t("coach.student.unlink_error_title"),description:r.message})}finally{B(!1)}}},ke=async()=>{var b;if(!a)return;const r=P.trim()||null,s=L.trim()||null,n=j.trim()||null,c=[r,s].filter(Boolean).join(" ").trim()||null;K(!0);try{let d=A;if(v){const ye=((b=v.name.split(".").pop())==null?void 0:b.toLowerCase())||"jpg",se=`${a.id}/avatar.${ye}`,{error:ae}=await i.storage.from(ne).upload(se,v,{upsert:!0,contentType:v.type||"image/jpeg"});if(ae)throw ae;const{data:Se}=i.storage.from(ne).getPublicUrl(se);d=`${Se.publicUrl}?t=${Date.now()}`}const{error:te}=await i.from("profiles").upsert({user_id:a.id,role:h,first_name:r,last_name:s,gym_name:n,full_name:c,avatar_url:d},{onConflict:"user_id"});if(te)throw te;await i.auth.updateUser({data:{full_name:c}}),o({isOpen:!0,variant:"success",title:t("profile.profile_saved_title"),description:t("profile.profile_saved_desc")}),H(r??""),V(s??""),J(n??""),N(d),Q(d),I(null),q(!1)}catch(d){o({isOpen:!0,variant:"danger",title:t("profile.profile_error_title"),description:d.message})}finally{K(!1)}},X=()=>{O(fe),U(pe),R(be),N(ge),I(null),q(!1)},_e=r=>{var n;const s=(n=r.target.files)==null?void 0:n[0];if(s){if(!s.type.startsWith("image/")){o({isOpen:!0,variant:"warning",title:t("profile.photo_invalid_title"),description:t("profile.photo_invalid_desc")});return}I(s),N(URL.createObjectURL(s))}};return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-neutral-950 text-neutral-900 dark:text-white pb-20",children:[e.jsxs("header",{className:"p-4 flex items-center gap-4 sticky top-0 bg-white/80 dark:bg-neutral-950/80 backdrop-blur-md z-10 border-b border-neutral-200 dark:border-neutral-800",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>f("/"),children:e.jsx(Re,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-xl font-bold",children:t("profile.title")})]}),e.jsxs("main",{className:"p-4 space-y-8 max-w-lg mx-auto",children:[e.jsxs("section",{className:"flex flex-col items-center py-6 space-y-4",children:[A?e.jsx("img",{src:A,alt:k,className:"h-24 w-24 rounded-full object-cover shadow-xl shadow-emerald-500/20 border border-neutral-200 dark:border-neutral-800"}):e.jsx("div",{className:"h-24 w-24 bg-emerald-500 rounded-full flex items-center justify-center text-4xl font-bold text-white shadow-xl shadow-emerald-500/20",children:(k[0]||((ee=a==null?void 0:a.email)==null?void 0:ee[0])||"?").toUpperCase()}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:k}),e.jsxs("p",{className:"text-neutral-500 dark:text-neutral-400 flex items-center justify-center gap-1.5 mt-1",children:[e.jsx(Ae,{className:"h-4 w-4"}),a==null?void 0:a.email]})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-neutral-400 dark:text-neutral-500 uppercase tracking-wider px-1",children:t("profile.account")}),e.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-800",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-base font-semibold text-neutral-900 dark:text-neutral-100",children:k}),j.trim()?e.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:t("profile.training_at",{gym:j.trim()})}):null]}),e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>q(!0),disabled:u,className:"h-8 px-2 text-neutral-600 dark:text-neutral-300",children:[e.jsx(Ie,{className:"h-4 w-4 mr-1.5"}),t("common.edit")]})]})}),e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-neutral-200 dark:border-neutral-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-blue-500/10 text-blue-500 rounded-xl flex items-center justify-center",children:e.jsx(le,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:t("profile.verification_status")}),e.jsx("p",{className:"text-xs text-neutral-500",children:t("profile.verification_desc")})]})]}),ve?e.jsxs("span",{className:"flex items-center gap-1 text-xs font-bold text-emerald-500 bg-emerald-500/10 px-2.5 py-1 rounded-full",children:[e.jsx(le,{className:"h-3 w-3"}),t("profile.verified")]}):e.jsxs("span",{className:"flex items-center gap-1 text-xs font-bold text-amber-500 bg-amber-500/10 px-2.5 py-1 rounded-full",children:[e.jsx(Ee,{className:"h-3 w-3"}),t("profile.not_verified")]})]}),e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-neutral-200 dark:border-neutral-800",children:[e.jsx("p",{className:"font-semibold",children:t("profile.account_type")}),e.jsx("span",{className:"text-xs font-bold text-emerald-500 bg-emerald-500/10 px-2.5 py-1 rounded-full",children:t(h==="instrutor"?"auth.register.role_instructor":"auth.register.role_student")})]}),e.jsx("button",{onClick:()=>f("/archive"),className:"w-full p-4 flex items-center justify-between hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors border-t border-neutral-200 dark:border-neutral-800 group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-amber-500/10 text-amber-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform",children:e.jsx(Fe,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold",children:t("workouts.archived","Archived Workouts")}),e.jsx("p",{className:"text-xs text-neutral-500",children:t("workouts.count",{count:de})})]})]})}),h==="instrutor"&&e.jsx("button",{onClick:()=>f("/coach-panel"),className:"w-full p-4 flex items-center justify-between hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors border-t border-neutral-200 dark:border-neutral-800 group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-emerald-500/10 text-emerald-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform",children:e.jsx(Te,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold",children:t("coach.panel.title")}),e.jsx("p",{className:"text-xs text-neutral-500",children:t("coach.panel.subtitle")})]})]})})]})]}),h==="aluno"&&e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-neutral-400 dark:text-neutral-500 uppercase tracking-wider px-1",children:t("coach.student.section_title")}),e.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl p-4 space-y-3",children:xe?e.jsx("p",{className:"text-sm text-neutral-500",children:t("common.loading")}):p?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:(S==null?void 0:S.full_name)||t("coach.student.coach_unknown")}),e.jsx("p",{className:"text-xs text-neutral-500",children:t("coach.student.active_link")})]}),me?e.jsx("p",{className:"text-xs text-amber-500",children:t("coach.student.pending_unlink_request")}):e.jsx(x,{variant:"outline",size:"sm",onClick:we,disabled:z,children:t(z?"common.loading":"coach.student.request_unlink")})]})}):e.jsx("p",{className:"text-sm text-neutral-500",children:t("coach.student.no_coach")})})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-neutral-400 dark:text-neutral-500 uppercase tracking-wider px-1",children:t("profile.security")}),e.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-amber-500/10 text-amber-500 rounded-xl flex items-center justify-center",children:e.jsx($e,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:t("profile.password_label")}),e.jsx("p",{className:"text-xs text-neutral-500",children:t("profile.password_desc")})]})]}),e.jsx(x,{variant:"outline",size:"sm",onClick:Ne,disabled:T||F,className:"text-xs",children:t(F?"profile.reset_password_sent":T?"common.loading":"profile.reset_password")})]})})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-neutral-400 dark:text-neutral-500 uppercase tracking-wider px-1",children:t("profile.system")}),e.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>ce(),type:"button",className:"w-full p-4 flex items-center justify-between hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors cursor-pointer group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-purple-500/10 text-purple-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform",children:y==="dark"?e.jsx(Ge,{className:"h-5 w-5 fill-current"}):e.jsx(Me,{className:"h-5 w-5"})}),e.jsx("div",{className:"text-left",children:e.jsx("p",{className:"font-semibold text-neutral-900 dark:text-white",children:t("profile.theme")})})]}),e.jsx("div",{className:`h-6 w-11 rounded-full relative p-1 transition-colors ${y==="dark"?"bg-emerald-600":"bg-neutral-300"}`,children:e.jsx("div",{className:`h-4 w-4 bg-white rounded-full shadow-sm transform transition-transform duration-200 ${y==="dark"?"translate-x-5":"translate-x-0"}`})})]}),e.jsxs("div",{className:"p-4 flex items-center justify-between border-t border-neutral-200 dark:border-neutral-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-emerald-500/10 text-emerald-500 rounded-xl flex items-center justify-center",children:e.jsx(We,{className:"h-5 w-5"})}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold",children:t("profile.language")})})]}),e.jsxs("div",{className:"flex bg-neutral-100 dark:bg-neutral-800 p-1 rounded-lg border border-neutral-200 dark:border-neutral-700",children:[e.jsx("button",{onClick:()=>g.changeLanguage("en"),className:re("px-3 py-1 text-xs font-semibold rounded-md transition-all",g.language.startsWith("en")?"bg-white dark:bg-neutral-700 text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300"),children:"EN"}),e.jsx("button",{onClick:()=>g.changeLanguage("pt"),className:re("px-3 py-1 text-xs font-semibold rounded-md transition-all",g.language.startsWith("pt")?"bg-white dark:bg-neutral-700 text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300"),children:"PT"})]})]})]})]}),e.jsx("section",{className:"space-y-4",children:e.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden",children:e.jsx("button",{onClick:()=>f("/about"),className:"w-full p-4 flex items-center justify-between hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-sky-500/10 text-sky-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform",children:e.jsx(ze,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold",children:t("about.title")}),e.jsx("p",{className:"text-xs text-neutral-500",children:t("about.short")})]})]})})})}),e.jsx("section",{className:"pt-4",children:e.jsxs(x,{variant:"ghost",className:"w-full py-6 text-red-500 hover:text-red-600 hover:bg-red-500/10 rounded-2xl flex items-center justify-center gap-2 font-bold",onClick:je,children:[e.jsx(Be,{className:"h-5 w-5"}),t("common.logout")]})})]}),e.jsx(Oe,{isOpen:w.isOpen,onClose:()=>o(r=>({...r,isOpen:!1})),title:w.title,description:w.description,variant:w.variant}),e.jsx(Le,{isOpen:he,onClose:X,title:t("common.edit"),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-200",children:t("profile.first_name")}),e.jsx(_,{value:P,onChange:r=>O(r.target.value),placeholder:t("profile.first_name"),disabled:u||m})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-200",children:t("profile.last_name")}),e.jsx(_,{value:L,onChange:r=>U(r.target.value),placeholder:t("profile.last_name"),disabled:u||m})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-200",children:t("profile.gym_name")}),e.jsx(_,{value:j,onChange:r=>R(r.target.value),placeholder:t("profile.gym_placeholder"),disabled:u||m})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-200",children:t("profile.photo_label")}),e.jsx(_,{type:"file",accept:"image/*",onChange:_e,disabled:u||m}),e.jsx("p",{className:"text-xs text-neutral-500",children:t("profile.photo_help")})]}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx(x,{variant:"outline",onClick:X,disabled:u||m,className:"flex-1",children:t("common.cancel")}),e.jsx(x,{onClick:ke,disabled:u||m,className:"flex-1",children:t(m?"common.loading":"common.save")})]})]})})]})}export{st as default};
