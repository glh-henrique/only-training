const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-3opq90BV.js","assets/vendor-D7ki0F_6.js","assets/button-o7loT5aq.js","assets/alert-modal-CsFPAJ0f.js","assets/icons-DXq1rHtP.js","assets/i18n-Bm7ldLcC.js","assets/router-DsEtcPPD.js","assets/input-BlcyNeZr.js","assets/skeleton-DnvUEloq.js","assets/supabase-DVQvS8qL.js","assets/Login-BXczrffW.js","assets/Register-DHyOf3S7.js","assets/RegisterConfirmation-RnUPAli9.js","assets/WorkoutSession-gFRD9Evy.js","assets/WorkoutEditor-1tIeVyaP.js","assets/History-DF8iGWLo.js","assets/date-CBpsKyOP.js","assets/ArchivedWorkouts-ggObyMHS.js","assets/ForgotPassword-C_SmlzGL.js","assets/ResetPassword-DEECzDNE.js","assets/Profile-DBvtbemL.js"])))=>i.map(i=>d[i]);
import{b as v,p as S,d as L,j as u,r as h,t as N,e as j,f as T}from"./vendor-D7ki0F_6.js";import{i as D,B as q,a as A,u as I}from"./i18n-Bm7ldLcC.js";import{c as C}from"./supabase-DVQvS8qL.js";import{N as k,O,R as P,a as g,H as R}from"./router-DsEtcPPD.js";import{W as Q}from"./icons-DXq1rHtP.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function c(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(t){if(t.ep)return;t.ep=!0;const o=c(t);fetch(t.href,o)}})();const z={loading:"Loading...",save:"Save",cancel:"Cancel",edit:"Edit",delete:"Delete",create:"Create",name:"Name",notes:"Notes",video_url:"Video link",add:"Add",weight:"Weight",sets:"Sets",rest:"Rest",rest_seconds:"Rest (seconds)",reps:"Reps",email:"Email",password:"Password",logout:"Sign Out",optional:"Optional",ok:"OK",status:{offline:"Offline",syncing:"Syncing..."}},V={login:{title:"Login",subtitle:"Welcome back to OnlyTraining",email:"Email address",password:"Password",submit:"Sign In",forgot_password_link:"Forgot your password?",no_account:"Don't have an account? Register"},forgot_password:{title:"Forgot Password?",subtitle:"Enter your email to receive a reset link",submit:"Send Link",success:"Link sent! Please check your email.",back_to_login:"Back to Login"},reset_password:{title:"New Password",subtitle:"Choose a strong password for your security",new_password:"New Password",confirm_password:"Confirm New Password",submit:"Reset Password",success:"Password reset successfully!",error:"Error resetting password. Please try again."},register:{title:"Create Account",subtitle:"Start your journey today",name:"Full Name",email:"Email address",password:"Password",confirm_password:"Confirm Password",submit:"Create Account",has_account:"Already have an account? Login"}},F={greeting:"Hello, {{name}}",ready:"Ready to train?",last_activity:"Last Activity",last_activity_text:"You trained <1>{{workout}}</1>",duration:"{{minutes}} min",workouts:"Your Workouts",no_workouts:"No workouts found.",create_first:"Create your first workout",create_modal_title:"Create New Workout",focus:"Focus (e.g., Chest & Triceps)",notes_placeholder:"Any special instructions..."},H={archived:"Archived Workouts",count:"{{count}} workout",count_plural:"{{count}} workouts",archive_empty_title:"Archive Empty",archive_empty_desc:"Your archived workouts will appear here.",unarchive_title:"Unarchive Workout?",unarchive_desc:"This workout will appear back in your main list on Home. Do you want to continue?",delete_title:"Delete Workout?",delete_desc:"This action will remove the workout and all its history permanently. This cannot be undone.",delete_desc_full:"This action cannot be undone. The workout and its history will be permanently removed.",edit:"Edit Workout",archive:"Archive Workout",archive_title:"Archive Workout?",archive_desc:"This workout will be moved to the archive and will no longer appear on the Home. You can restore it later.",archive_confirm:"Archive",last_completed:"Last:",in_progress:"In Progress",start_workout:"Start Workout",no_items:"No exercises yet",cancel_active:"Cancel Workout",cancel_active_title:"Cancel active workout?",cancel_active_desc:"This will discard the current active session and its data.",cancel_active_confirm:"Cancel workout"},M={title:"History",no_sessions:"No sessions found yet. Go train!",total_duration:"Total Duration",volume_short:"kg"},Y={title:"Profile",account:"Account Information",verified:"Verified",not_verified:"Not Verified",security:"Security",reset_password:"Reset Password",settings:"App Settings",theme:"Theme",language:"Language",stats:"Statistics",system:"System",verification_status:"Verification Status",verification_desc:"Identity confirmation",password_label:"Password",password_desc:"Reset your access password",reset_email_sent_title:"Email Sent",reset_email_sent_desc:"Check your inbox to reset your password.",reset_password_sent:"Email Sent",reset_error_title:"Error Resetting"},J={title:"Edit {{name}}",exercises:"Exercises",add_exercise:"Add Exercise",exercise_title:"Exercise Title",reps:"Reps",order:"Order",preparing:"Preparing editor..."},$={active:"Active Workout",not_started:"Workout not started",finish:"Finish Workout",next:"Next Exercise",done:"Done",notes:"Instructional Notes",target:"Target",conflict:{title:"Active Workout Found",description:"You have an active session for <1>{{workout}}</1>.",question:"Do you want to discard it and start this new workout, or resume the active one?",resume:"Resume {{workout}}",discard:"Discard & Start New"},empty_help:"If you recently added exercises to this workout, this session might be using an old snapshot. Discarding it will let you start a fresh one.",finish_hint:"Complete at least {{count}} exercises to finish ({{current}}/{{count}})",finish_modal_title:"Finish Workout?",finish_modal_desc:"Great job! You've been training for <1>{{formattedTime}}</1>.",keep_training:"Keep Training",start_rest:"Start rest",rest_running:"Rest {{seconds}}s",rest_done_title:"Rest complete",rest_done_desc:"Time to start another set for {{exercise}}.",discard_modal_title:"Discard Session?",discard_modal_desc:"Are you sure you want to discard this session? All currently recorded data will be lost.",long_workout_notification:"Your workout has been going on for over 1 hour!",long_workout_modal_desc:"You've been training for over an hour. Remember to stay hydrated and rest if needed!",continue_training:"Continue training",finish_workout:"Finish workout"},U={common:z,auth:V,home:F,workouts:H,history:M,profile:Y,editor:J,session:$},B={loading:"Carregando...",save:"Salvar",cancel:"Cancelar",edit:"Editar",delete:"Excluir",create:"Criar",name:"Nome",notes:"Notas",video_url:"Link do vídeo",add:"Adicionar",weight:"Peso",sets:"Séries",rest:"Descanso",rest_seconds:"Descanso (segundos)",reps:"Reps",email:"E-mail",password:"Senha",logout:"Sair",optional:"Opcional",ok:"OK",status:{offline:"Offline",syncing:"Sincronizando..."}},K={login:{title:"Login",subtitle:"Bem-vindo de volta ao OnlyTraining",email:"Endereço de e-mail",password:"Senha",submit:"Entrar",forgot_password_link:"Esqueceu sua senha?",no_account:"Não tem uma conta? Registre-se"},forgot_password:{title:"Esqueceu a senha?",subtitle:"Digite seu e-mail para receber um link de redefinição",submit:"Enviar Link",success:"Link enviado! Verifique seu e-mail.",back_to_login:"Voltar para o Login"},reset_password:{title:"Nova Senha",subtitle:"Escolha uma senha forte para sua segurança",new_password:"Nova Senha",confirm_password:"Confirmar Nova Senha",submit:"Redefinir Senha",success:"Senha redefinida com sucesso!",error:"Erro ao redefinir senha. Tente novamente."},register:{title:"Criar Conta",subtitle:"Comece sua jornada hoje",name:"Nome Completo",email:"Endereço de e-mail",password:"Senha",confirm_password:"Confirmar Senha",submit:"Criar Conta",has_account:"Já tem uma conta? Login"}},G={greeting:"Olá, {{name}}",ready:"Pronto para treinar?",last_activity:"Última Atividade",last_activity_text:"Você treinou <1>{{workout}}</1>",duration:"{{minutes}} min",workouts:"Seus Treinos",no_workouts:"Nenhum treino encontrado.",create_first:"Crie seu primeiro treino",create_modal_title:"Criar Novo Treino",focus:"Foco (ex: Peito e Tríceps)",notes_placeholder:"Qualquer instrução especial..."},Z={archived:"Treinos Arquivados",count:"{{count}} treino",count_plural:"{{count}} treinos",archive_empty_title:"Arquivo Vazio",archive_empty_desc:"Seus treinos arquivados aparecerão aqui.",unarchive_title:"Reativar Treino?",unarchive_desc:"Este treino voltará a aparecer na sua lista principal na Home. Deseja continuar?",delete_title:"Excluir Treino?",delete_desc:"Esta ação removerá o treino e todo o seu histórico permanentemente. Não é possível desfazer.",delete_desc_full:"Esta ação não pode ser desfeita. O treino e seu histórico serão removidos permanentemente.",edit:"Editar Treino",archive:"Arquivar Treino",archive_title:"Arquivar Treino?",archive_desc:"Este treino será movido para o arquivo e não aparecerá mais na Home. Você pode restaurá-lo depois.",archive_confirm:"Arquivar",last_completed:"Última:",in_progress:"Em andamento",start_workout:"Começar Treino",no_items:"Nenhum exercicio ainda",cancel_active:"Cancelar Treino",cancel_active_title:"Cancelar treino ativo?",cancel_active_desc:"Isso vai descartar a sessão ativa e seus dados.",cancel_active_confirm:"Cancelar treino"},X={title:"Histórico",no_sessions:"Nenhuma sessão encontrada. Vá treinar!",total_duration:"Duração Total",volume_short:"kg"},ee={title:"Perfil",account:"Informações da Conta",verified:"Verificado",not_verified:"Não Verificado",security:"Segurança",reset_password:"Redefinir Senha",settings:"Configurações do App",theme:"Tema",language:"Idioma",stats:"Estatísticas",system:"Sistema",verification_status:"Status de Verificação",verification_desc:"Confirmação de identidade",password_label:"Senha",password_desc:"Redefinir sua senha de acesso",reset_email_sent_title:"E-mail Enviado",reset_email_sent_desc:"Verifique sua caixa de entrada para redefinir sua senha.",reset_password_sent:"E-mail Enviado",reset_error_title:"Erro ao Redefinir"},te={title:"Editar {{name}}",exercises:"Exercícios",add_exercise:"Adicionar Exercício",exercise_title:"Título do Exercício",reps:"Reps",order:"Ordem",preparing:"Preparando editor..."},oe={active:"Treino Ativo",not_started:"Treino nao iniciado",finish:"Finalizar Treino",next:"Próximo Exercício",done:"Concluir",notes:"Instruções",target:"Alvo",conflict:{title:"Treino Ativo Encontrado",description:"Você já tem uma sessão ativa para <1>{{workout}}</1>.",question:"Deseja descartar a sessão anterior e começar este novo treino, ou retomar a ativa?",resume:"Retomar {{workout}}",discard:"Descartar e Começar Novo"},empty_help:"Se você adicionou exercícios recentemente, esta sessão pode estar usando uma versão antiga. Descartá-la permitirá começar uma nova com os exercícios atuais.",finish_hint:"Conclua pelo menos {{count}} exercícios para finalizar ({{current}}/{{count}})",finish_modal_title:"Finalizar Treino?",finish_modal_desc:"Bom trabalho! Você está treinando há <1>{{formattedTime}}</1>.",keep_training:"Continuar Treinando",start_rest:"Iniciar descanso",rest_running:"Descanso {{seconds}}s",rest_done_title:"Descanso concluído",rest_done_desc:"Hora de começar outra série para {{exercise}}.",discard_modal_title:"Descartar Sessão?",discard_modal_desc:"Tem certeza que deseja descartar esta sessão? Todos os dados registrados serão perdidos.",long_workout_notification:"Seu treino já dura mais de 1 hora!",long_workout_modal_desc:"Você está treinando há mais de uma hora. Lembre-se de se hidratar e descansar se necessário!",continue_training:"Continuar treinando",finish_workout:"Finalizar treino"},re={common:B,auth:K,home:G,workouts:Z,history:X,profile:ee,editor:te,session:oe};D.use(q).use(A).init({resources:{en:{translation:U},pt:{translation:re}},fallbackLng:"en",interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"]}});const se="modulepreload",ie=function(e){return"/only-training/"+e},E={},p=function(d,c,s){let t=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),i=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));t=Promise.allSettled(c.map(a=>{if(a=ie(a),a in E)return;E[a]=!0;const n=a.endsWith(".css"),l=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${l}`))return;const _=document.createElement("link");if(_.rel=n?"stylesheet":se,n||(_.as="script"),_.crossOrigin="",_.href=a,i&&_.setAttribute("nonce",i),document.head.appendChild(_),n)return new Promise((w,f)=>{_.addEventListener("load",w),_.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${a}`)))})}))}function o(r){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=r,window.dispatchEvent(i),!i.defaultPrevented)throw r}return t.then(r=>{for(const i of r||[])i.status==="rejected"&&o(i.reason);return d().catch(o)})},ne="https://nwkfurorlmrhwywiqpvc.supabase.co",ae="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im53a2Z1cm9ybG1yaHd5d2lxcHZjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2MjExMTUsImV4cCI6MjA4NTE5NzExNX0.TmEiCa89YhOlEEcE72MhIfE0JWw2QyQz2JGI63P463s",m=C(ne,ae),y=v(e=>({user:null,session:null,isLoading:!0,initialize:async()=>{try{const{data:{session:d}}=await m.auth.getSession();e({session:d,user:(d==null?void 0:d.user)??null,isLoading:!1}),m.auth.onAuthStateChange((c,s)=>{e({session:s,user:(s==null?void 0:s.user)??null,isLoading:!1})})}catch(d){console.error("Auth initialization error:",d),e({isLoading:!1})}},signOut:async()=>{await m.auth.signOut(),e({session:null,user:null})}})),ce=v()(S((e,d)=>({workouts:[],archivedCount:0,lastSession:null,activeWorkoutItems:[],isLoading:!1,error:null,syncQueue:[],processSyncQueue:async()=>{if(!navigator.onLine||d().syncQueue.length===0)return;const c=[...d().syncQueue].sort((s,t)=>s.timestamp-t.timestamp);e({syncQueue:[]});for(const s of c)try{s.action==="archive"&&await d().archiveWorkout(s.id),s.action==="unarchive"&&await d().unarchiveWorkout(s.id),s.action==="delete"&&await d().deleteWorkout(s.id)}catch(t){console.error("Failed to sync item:",s,t),e(o=>({syncQueue:[...o.syncQueue,s]}))}},fetchWorkouts:async()=>{e({isLoading:!0,error:null});try{const c=y.getState().user;if(!c)return;const{data:s,error:t}=await m.from("workouts").select("*").eq("user_id",c.id).eq("is_archived",!1).order("created_at",{ascending:!1});if(t)throw t;const{count:o,error:r}=await m.from("workouts").select("*",{count:"exact",head:!0}).eq("user_id",c.id).eq("is_archived",!0);if(r)throw r;const{data:i,error:a}=await m.from("workout_sessions").select("*").eq("user_id",c.id).eq("status","finished").order("ended_at",{ascending:!1});if(a)throw a;const n={},l={};i==null||i.forEach(f=>{f.workout_id&&(n[f.workout_id]=(n[f.workout_id]||0)+1,!l[f.workout_id]&&f.ended_at&&(l[f.workout_id]=f.ended_at))});const _=s.map(f=>({...f,completed_count:n[f.id]||0,last_completed_at:l[f.id]})),w=i&&i.length>0?i[0]:null;e({workouts:_,lastSession:w,archivedCount:o||0})}catch(c){e({error:c.message})}finally{e({isLoading:!1})}},createWorkout:async(c,s,t)=>{e({isLoading:!0,error:null});try{const o=y.getState().user;if(!o)throw new Error("User not authenticated");const{data:r,error:i}=await m.from("workouts").insert({user_id:o.id,name:c,focus:s,notes:t}).select().single();if(i)throw i;const a=d().workouts;return e({workouts:[r,...a]}),r.id}catch(o){return e({error:o.message}),null}finally{e({isLoading:!1})}},deleteWorkout:async c=>{e({isLoading:!0,error:null});try{const{error:s}=await m.from("workouts").delete().eq("id",c);if(s)throw s;const t=d().workouts;e({workouts:t.filter(o=>o.id!==c)})}catch(s){e({error:s.message})}finally{e({isLoading:!1})}},archiveWorkout:async c=>{const s=d().workouts;if(e({workouts:s.filter(t=>t.id!==c)}),!navigator.onLine){e(t=>({syncQueue:[...t.syncQueue,{id:c,action:"archive",timestamp:Date.now()}]}));return}e({isLoading:!0,error:null});try{const{error:t}=await m.from("workouts").update({is_archived:!0}).eq("id",c);if(t)throw t}catch(t){e({error:t.message,workouts:s})}finally{e({isLoading:!1})}},unarchiveWorkout:async c=>{if(!navigator.onLine){e(s=>({syncQueue:[...s.syncQueue,{id:c,action:"unarchive",timestamp:Date.now()}]}));return}e({isLoading:!0,error:null});try{const{error:s}=await m.from("workouts").update({is_archived:!1}).eq("id",c);if(s)throw s;await d().fetchWorkouts()}catch(s){e({error:s.message})}finally{e({isLoading:!1})}},fetchWorkoutItems:async c=>{e({isLoading:!0,error:null});try{const{data:s,error:t}=await m.from("workout_items").select("*").eq("workout_id",c).order("order_index");if(t)throw t;e({activeWorkoutItems:s})}catch(s){e({error:s.message})}finally{e({isLoading:!1})}},addWorkoutItem:async(c,s,t,o,r,i,a,n)=>{e({isLoading:!0,error:null});try{const l=y.getState().user;if(!l)throw new Error("User not authenticated");const _=n==null?void 0:n.trim(),w={workout_id:c,user_id:l.id,title:s,order_index:t,default_reps:o,default_sets:r,rest_seconds:i,notes:a,..._?{video_url:_}:{}},{data:f,error:x}=await m.from("workout_items").insert(w).select().single();if(x)throw x;const W=d().activeWorkoutItems;e({activeWorkoutItems:[...W,f]})}catch(l){e({error:l.message})}finally{e({isLoading:!1})}},updateWorkoutItem:async(c,s)=>{var o;const t=d().activeWorkoutItems;e({activeWorkoutItems:t.map(r=>r.id===c?{...r,...s}:r)});try{const r=(o=s.video_url)==null?void 0:o.trim(),i={...s};r?i.video_url=r:delete i.video_url;const{error:a}=await m.from("workout_items").update(i).eq("id",c);if(a)throw a}catch(r){e({error:r.message,activeWorkoutItems:t})}},deleteWorkoutItem:async c=>{const s=d().activeWorkoutItems;e({activeWorkoutItems:s.filter(t=>t.id!==c)});try{const{error:t}=await m.from("workout_items").delete().eq("id",c);if(t)throw t}catch(t){e({error:t.message}),e({activeWorkoutItems:s})}}}),{name:"only-training-workouts",storage:L(()=>localStorage),partialize:e=>({workouts:e.workouts,archivedCount:e.archivedCount,syncQueue:e.syncQueue})}));function de(){const{session:e,isLoading:d}=y();return d?u.jsx("div",{className:"flex items-center justify-center min-h-screen bg-white dark:bg-neutral-950 text-neutral-900 dark:text-white transition-colors",children:u.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-emerald-500"})}):e?u.jsx(O,{}):u.jsx(k,{to:"/login",replace:!0})}const ue=v()(S(e=>({theme:"dark",setTheme:d=>e({theme:d}),toggleTheme:()=>e(d=>({theme:d.theme==="light"?"dark":"light"}))}),{name:"theme-storage"})),b=v()(S((e,d)=>{const c=()=>{const{intervalId:t}=d();t&&clearInterval(t),e({intervalId:null})},s=()=>{c();const t=()=>d().incrementDuration();t();const o=setInterval(t,1e3);e({intervalId:Number(o)})};return{currentSession:null,sessionItems:[],isLoading:!1,error:null,duration:0,intervalId:null,hasNotifiedLongWorkout:!1,syncQueue:[],processSyncQueue:async()=>{if(!navigator.onLine||d().syncQueue.length===0)return;const t=[...d().syncQueue].sort((o,r)=>o.timestamp-r.timestamp);e({syncQueue:[]});for(const o of t)try{if(o.action==="toggle_done"&&await m.from("session_items").update({is_done:o.payload.isDone,done_at:o.payload.doneAt}).eq("id",o.id),o.action==="update_stats"&&await m.from("session_items").update({weight:o.payload.weight,reps:o.payload.reps}).eq("id",o.id),o.action==="finish_session"&&(await m.from("workout_sessions").update({status:"finished",ended_at:o.payload.endedAt,duration_seconds:o.payload.duration}).eq("id",o.id),o.payload.defaultWeights&&o.payload.defaultWeights.length>0))for(const r of o.payload.defaultWeights)!r.workout_item_id||r.weight==null||await m.from("workout_items").update({default_weight:r.weight}).eq("id",r.workout_item_id)}catch(r){console.error("Failed to sync session item:",o,r),e(i=>({syncQueue:[...i.syncQueue,o]}))}},resumeSession:async()=>{const t=y.getState().user;if(!t){c(),e({currentSession:null,sessionItems:[],duration:0,isLoading:!1,hasNotifiedLongWorkout:!1});return}if(!d().isLoading)try{e({isLoading:!0,error:null});const{data:o,error:r}=await m.from("workout_sessions").select("*").eq("user_id",t.id).eq("status","in_progress").order("started_at",{ascending:!1});if(r){console.error("Failed to sync session",r);return}const i=(o==null?void 0:o[0])||null;if(i){c();const{data:a}=await m.from("session_items").select("*").eq("session_id",i.id).order("order_index"),n=new Date,l=new Date(i.started_at);if(!(n.getFullYear()===l.getFullYear()&&n.getMonth()===l.getMonth()&&n.getDate()===l.getDate())){console.log("Session expired (started on previous day), auto-finalizing..."),await m.from("workout_sessions").update({status:"finished",ended_at:new Date(l.setHours(23,59,59,999)).toISOString(),duration_seconds:Math.max(0,Math.floor((new Date(l.setHours(23,59,59,999)).getTime()-l.getTime())/1e3))}).eq("id",i.id),e({currentSession:null,sessionItems:[],duration:0,hasNotifiedLongWorkout:!1});return}const w=Math.floor((n.getTime()-l.getTime())/1e3);e({currentSession:i,sessionItems:a||[],duration:w,hasNotifiedLongWorkout:w>=3600}),s()}else c(),e({currentSession:null,sessionItems:[],duration:0,hasNotifiedLongWorkout:!1})}catch(o){console.error("Failed to resume session",o)}finally{e({isLoading:!1})}},startSession:async t=>{if(d().isLoading||d().currentSession)return"error";e({isLoading:!0,error:null});try{const o=y.getState().user;if(!o)throw new Error("User not authenticated");const{data:r}=await m.from("workouts").select("*").eq("id",t).maybeSingle();if(!r)throw new Error("Workout not found");const{data:i}=await m.from("workout_items").select("*").eq("workout_id",r.id).order("order_index");if(!i||i.length===0)return e({isLoading:!1}),"no_items";const{data:a,error:n}=await m.from("workout_sessions").insert({user_id:o.id,workout_id:r.id,workout_name_snapshot:r.name,workout_focus_snapshot:r.focus,status:"in_progress",started_at:new Date().toISOString()}).select().single();if(n)throw n;const l=i.map(f=>({user_id:o.id,session_id:a.id,workout_item_id:f.id,title_snapshot:f.title,notes_snapshot:f.notes,video_url:f.video_url,order_index:f.order_index,weight:f.default_weight,reps:f.default_reps,sets:f.default_sets,rest_seconds:f.rest_seconds,is_done:!1})),{error:_}=await m.from("session_items").insert(l);if(_)throw _;const{data:w}=await m.from("session_items").select("*").eq("session_id",a.id).order("order_index");return e({sessionItems:w||[]}),e({currentSession:a,duration:0}),s(),"started"}catch(o){return e({error:o.message}),"error"}finally{e({isLoading:!1})}},incrementDuration:()=>{const{currentSession:t,finishSession:o}=d();if(!t)return;const r=new Date,i=new Date(t.started_at);if(!(r.getFullYear()===i.getFullYear()&&r.getMonth()===i.getMonth()&&r.getDate()===i.getDate())){console.log("Day changed, auto-finalizing session..."),o();return}const n=Math.max(0,Math.floor((r.getTime()-i.getTime())/1e3));e(l=>l.duration===n?{}:{duration:n})},toggleItemDone:async(t,o)=>{const r=d().sessionItems.map(i=>i.id===t?{...i,is_done:o}:i);if(e({sessionItems:r}),!navigator.onLine){e(i=>({syncQueue:[...i.syncQueue.filter(a=>!(a.action==="toggle_done"&&a.id===t)),{id:t,action:"toggle_done",payload:{isDone:o,doneAt:o?new Date().toISOString():null},timestamp:Date.now()}]}));return}try{await m.from("session_items").update({is_done:o,done_at:o?new Date().toISOString():null}).eq("id",t)}catch(i){console.error(i),e(a=>({syncQueue:[...a.syncQueue.filter(n=>!(n.action==="toggle_done"&&n.id===t)),{id:t,action:"toggle_done",payload:{isDone:o,doneAt:o?new Date().toISOString():null},timestamp:Date.now()}]}))}},updateItemStats:async(t,o,r)=>{const i=d().sessionItems.map(a=>a.id===t?{...a,weight:o,reps:r}:a);if(e({sessionItems:i}),!navigator.onLine){e(a=>({syncQueue:[...a.syncQueue.filter(n=>!(n.action==="update_stats"&&n.id===t)),{id:t,action:"update_stats",payload:{weight:o,reps:r},timestamp:Date.now()}]}));return}try{await m.from("session_items").update({weight:o,reps:r}).eq("id",t)}catch(a){console.error(a),e(n=>({syncQueue:[...n.syncQueue.filter(l=>!(l.action==="update_stats"&&l.id===t)),{id:t,action:"update_stats",payload:{weight:o,reps:r},timestamp:Date.now()}]}))}},finishSession:async()=>{const{currentSession:t,duration:o,intervalId:r}=d();if(!t)return;e({isLoading:!0}),r&&c();const i=new Date().toISOString(),a=d().sessionItems.filter(n=>n.workout_item_id&&n.weight!=null).map(n=>({workout_item_id:n.workout_item_id,weight:n.weight}));if(!navigator.onLine){e(n=>({syncQueue:[...n.syncQueue.filter(l=>!(l.action==="finish_session"&&l.id===t.id)),{id:t.id,action:"finish_session",payload:{endedAt:i,duration:o,defaultWeights:a},timestamp:Date.now()}],currentSession:null,sessionItems:[],isLoading:!1}));return}try{await m.from("workout_sessions").update({status:"finished",ended_at:i,duration_seconds:o}).eq("id",t.id);const{sessionItems:n}=d();for(const l of n)l.workout_item_id&&l.weight&&await m.from("workout_items").update({default_weight:l.weight}).eq("id",l.workout_item_id);e({currentSession:null,sessionItems:[]})}catch(n){e({error:n.message})}finally{e({isLoading:!1})}},restartSession:async t=>{const o=y.getState().user;if(o){e({isLoading:!0,error:null}),c();try{await m.from("workout_sessions").update({status:"finished",ended_at:new Date().toISOString()}).eq("user_id",o.id).eq("status","in_progress"),e({currentSession:null,sessionItems:[],duration:0});const{data:r}=await m.from("workouts").select("*").eq("id",t).single();if(!r)throw new Error("Workout not found");const{data:i,error:a}=await m.from("workout_sessions").insert({user_id:o.id,workout_id:r.id,workout_name_snapshot:r.name,workout_focus_snapshot:r.focus,status:"in_progress",started_at:new Date().toISOString()}).select().single();if(a)throw a;const{data:n}=await m.from("workout_items").select("*").eq("workout_id",r.id).order("order_index");if(n&&n.length>0){const l=n.map(w=>({user_id:o.id,session_id:i.id,workout_item_id:w.id,title_snapshot:w.title,notes_snapshot:w.notes,video_url:w.video_url,order_index:w.order_index,weight:w.default_weight,reps:w.default_reps,sets:w.default_sets,rest_seconds:w.rest_seconds,is_done:!1}));await m.from("session_items").insert(l);const{data:_}=await m.from("session_items").select("*").eq("session_id",i.id).order("order_index");e({sessionItems:_||[]})}e({currentSession:i,duration:0}),s()}catch(r){console.error("[Store] restartSession failed:",r),e({error:r.message||"Failed to restart session"})}finally{e({isLoading:!1})}}},finishAllInProgressSessions:async()=>{const t=y.getState().user;if(t){e({isLoading:!0,error:null}),c();try{const{error:o}=await m.from("workout_sessions").update({status:"finished",ended_at:new Date().toISOString()}).eq("user_id",t.id).eq("status","in_progress");if(o)throw o;e({currentSession:null,sessionItems:[],duration:0})}catch(o){console.error("[Store] finishAllInProgressSessions failed:",o),e({error:o.message||"Failed to finish sessions"})}finally{e({isLoading:!1})}}},cancelSession:async(t=!1)=>{const o=y.getState().user;if(!o)return;const{currentSession:r,intervalId:i}=d();if(!(!r&&!t)){e({isLoading:!0,error:null}),i&&c();try{if(t){const{data:a}=await m.from("workout_sessions").select("id").eq("user_id",o.id).eq("status","in_progress");if(a&&a.length>0){const n=a.map(_=>_.id);await m.from("session_items").delete().in("session_id",n);const{error:l}=await m.from("workout_sessions").delete().in("id",n);if(l)throw l}}else if(r){const{error:a}=await m.from("session_items").delete().eq("session_id",r.id);if(a)throw a;const{error:n}=await m.from("workout_sessions").delete().eq("id",r.id);if(n)throw n}e({currentSession:null,sessionItems:[]})}catch(a){console.error("[Store] cancelSession failed:",a),e({error:a.message||"Failed to cancel session"})}finally{e({isLoading:!1})}}},setHasNotifiedLongWorkout:t=>{e({hasNotifiedLongWorkout:t})}}},{name:"only-training-session",storage:L(()=>localStorage),partialize:e=>({currentSession:e.currentSession,sessionItems:e.sessionItems,duration:e.duration,hasNotifiedLongWorkout:e.hasNotifiedLongWorkout,syncQueue:e.syncQueue})}));function le(){const{t:e}=I(),{duration:d,currentSession:c,hasNotifiedLongWorkout:s,setHasNotifiedLongWorkout:t}=b(),o=h.useRef(!1);h.useEffect(()=>{!o.current&&"Notification"in window&&(Notification.permission==="default"&&Notification.requestPermission(),o.current=!0)},[]),h.useEffect(()=>{c&&d>=3600&&!s&&document.visibilityState==="hidden"&&"Notification"in window&&Notification.permission==="granted"&&(navigator.serviceWorker.ready.then(r=>{r.showNotification("OnlyTraining",{body:e("session.long_workout_notification","Seu treino j� dura mais de 1 hora!"),icon:"/favicon.png",badge:"/favicon.png",tag:"long-workout-reminder",actions:[{action:"continue",title:e("session.continue_training","Continuar treinando")},{action:"finish",title:e("session.finish_workout","Finalizar treino")}]})}),t(!0))},[d,c,s,t,e])}function me(...e){return N(j(e))}function fe({className:e,fullPage:d=!1,text:c="Loading..."}){const s=u.jsxs("div",{className:me("flex flex-col items-center justify-center gap-4 animate-in fade-in duration-500",e),children:[u.jsxs("div",{className:"relative h-12 w-12",children:[u.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-emerald-500/20"}),u.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-emerald-500 border-t-transparent animate-spin"}),u.jsx("div",{className:"absolute inset-2 bg-emerald-500/20 rounded-full animate-pulse"})]}),c&&u.jsx("p",{className:"text-sm font-medium text-neutral-500 dark:text-neutral-400 animate-pulse",children:c})]});return d?u.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-white dark:bg-neutral-950",children:s}):s}const _e=h.lazy(()=>p(()=>import("./Home-3opq90BV.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),he=h.lazy(()=>p(()=>import("./Login-BXczrffW.js"),__vite__mapDeps([10,1,2,7,5,4,6,9]))),we=h.lazy(()=>p(()=>import("./Register-DHyOf3S7.js"),__vite__mapDeps([11,1,2,7,5,4,6,9]))),ge=h.lazy(()=>p(()=>import("./RegisterConfirmation-RnUPAli9.js"),__vite__mapDeps([12,1,2,5,4,6,9]))),pe=h.lazy(()=>p(()=>import("./WorkoutSession-gFRD9Evy.js"),__vite__mapDeps([13,1,2,7,3,4,5,6,9]))),ye=h.lazy(()=>p(()=>import("./WorkoutEditor-1tIeVyaP.js"),__vite__mapDeps([14,1,2,7,8,5,4,6,9]))),ve=h.lazy(()=>p(()=>import("./History-DF8iGWLo.js"),__vite__mapDeps([15,1,2,8,5,16,4,6,9]))),ke=h.lazy(()=>p(()=>import("./ArchivedWorkouts-ggObyMHS.js"),__vite__mapDeps([17,1,2,3,4,8,5,6,9]))),Se=h.lazy(()=>p(()=>import("./ForgotPassword-C_SmlzGL.js"),__vite__mapDeps([18,1,2,7,5,4,6,9]))),xe=h.lazy(()=>p(()=>import("./ResetPassword-DEECzDNE.js"),__vite__mapDeps([19,1,2,7,5,4,6,9]))),Ee=h.lazy(()=>p(()=>import("./Profile-DBvtbemL.js"),__vite__mapDeps([20,1,2,3,4,5,6,9])));function Le(){const{t:e}=I();le();const{initialize:d,session:c}=y(),{theme:s}=ue(),{processSyncQueue:t}=ce(),{finishSession:o,processSyncQueue:r}=b();h.useEffect(()=>{const n=l=>{var _;((_=l.data)==null?void 0:_.type)==="FINISH_WORKOUT"&&o()};return navigator.serviceWorker.addEventListener("message",n),()=>navigator.serviceWorker.removeEventListener("message",n)},[o]);const[i,a]=h.useState(!navigator.onLine);return h.useEffect(()=>{d()},[d]),h.useEffect(()=>{const n=()=>{a(!1),t(),r()},l=()=>a(!0);return window.addEventListener("online",n),window.addEventListener("offline",l),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",l)}},[t]),h.useEffect(()=>{const n=window.document.documentElement;n.classList.remove("light","dark"),n.classList.add(s),n.style.setProperty("color-scheme",s)},[s]),u.jsxs("div",{className:"min-h-screen bg-white dark:bg-neutral-950 text-neutral-900 dark:text-white font-sans antialiased transition-colors duration-300",children:[u.jsx(h.Suspense,{fallback:u.jsx(fe,{fullPage:!0}),children:u.jsxs(P,{children:[u.jsx(g,{path:"/login",element:c?u.jsx(k,{to:"/"}):u.jsx(he,{})}),u.jsx(g,{path:"/register",element:c?u.jsx(k,{to:"/"}):u.jsx(we,{})}),u.jsx(g,{path:"/register-confirmation",element:u.jsx(ge,{})}),u.jsx(g,{path:"/forgot-password",element:u.jsx(Se,{})}),u.jsx(g,{path:"/reset-password",element:u.jsx(xe,{})}),u.jsxs(g,{element:u.jsx(de,{}),children:[u.jsx(g,{path:"/",element:u.jsx(_e,{})}),u.jsx(g,{path:"/workout/:workoutId",element:u.jsx(pe,{})}),u.jsx(g,{path:"/workout/:workoutId/edit",element:u.jsx(ye,{})}),u.jsx(g,{path:"/history",element:u.jsx(ve,{})}),u.jsx(g,{path:"/archive",element:u.jsx(ke,{})}),u.jsx(g,{path:"/profile",element:u.jsx(Ee,{})})]})]})}),i&&u.jsx("div",{className:"fixed bottom-4 left-4 right-4 bg-amber-500 text-white px-4 py-3 rounded-xl shadow-lg flex items-center justify-between z-50 animate-in slide-in-from-bottom-4",children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx(Q,{className:"h-5 w-5"}),u.jsxs("div",{className:"text-sm",children:[u.jsx("p",{className:"font-bold",children:e("common.status.offline")}),u.jsxs("p",{className:"opacity-90",children:[e("home.ready")," (Offline Mode)"]})]})]})})]})}T.createRoot(document.getElementById("root")).render(u.jsx(h.StrictMode,{children:u.jsx(R,{children:u.jsx(Le,{})})}));export{fe as L,b as a,y as b,me as c,ue as d,m as s,ce as u};
