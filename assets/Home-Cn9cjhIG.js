import{r as i,j as e}from"./vendor-RJ-jBvc8.js";import{u as _,a as C,c as $,s as R,b as B}from"./index-DDRIOiMr.js";import{B as m}from"./button-BN3Rn6AQ.js";import{A as Z,M as P}from"./alert-modal-C0rStz1h.js";import{u as A,T as K}from"./i18n-DvSS2Fqm.js";import{u as H,L as w}from"./router-DrPDuPhB.js";import{T as U,P as V,E as Y,S as G,a as J,A as Q,b as X,H as ee,Z as te,c as se}from"./icons-C8fbylrd.js";import{I as q}from"./input-BJp3yCMu.js";import{S as d}from"./skeleton-BnRvzEm3.js";import"./supabase-BfAM1BYj.js";function ae({workout:l,isActive:s}){const{t}=A(),x=H(),[p,c]=i.useState(!1),[a,h]=i.useState({isOpen:!1,type:null}),u=i.useRef(null),j=_(r=>r.archiveWorkout),v=_(r=>r.deleteWorkout),N=C(r=>r.duration),k=C(r=>r.cancelSession),y=new Date(N*1e3).toISOString().substr(14,5);i.useEffect(()=>{function r(o){u.current&&!u.current.contains(o.target)&&c(!1)}return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const f=l.completed_count||0,b=async r=>{r&&r.preventDefault();try{const{count:o,error:g}=await R.from("workout_items").select("id",{count:"exact",head:!0}).eq("workout_id",l.id);if(g)throw g;if(!o||o===0){x(`/workout/${l.id}/edit`);return}x(`/workout/${l.id}`,{state:{autoStart:!0}})}catch(o){console.error("[WorkoutCard] Failed to check items count:",o),x(`/workout/${l.id}`,{state:{autoStart:!0}})}};return e.jsxs("div",{className:$("bg-neutral-50 dark:bg-neutral-900 border rounded-xl p-4 flex items-center justify-between group transition-all",s?"border-emerald-500/50 bg-emerald-50 dark:bg-emerald-950/10":"border-neutral-200 dark:border-neutral-800 hover:border-emerald-500/50"),children:[e.jsx(w,{to:`/workout/${l.id}`,className:"flex-1",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[f>0&&e.jsxs("span",{className:"flex items-center gap-1 text-amber-500/80 bg-amber-500/10 px-2 py-0.5 rounded-full",children:[e.jsx(U,{className:"h-3 w-3"}),f]}),l.last_completed_at&&e.jsxs("span",{className:"text-neutral-500 text-xs flex items-center",children:[t("workouts.last_completed")," ",new Date(l.last_completed_at).toLocaleDateString(void 0,{month:"short",day:"numeric"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-lg text-neutral-900 dark:text-white group-hover:text-emerald-500 transition-colors",children:l.name}),s&&e.jsxs("div",{className:"flex items-center gap-1.5 ml-1",children:[e.jsx("span",{className:"flex h-2 w-2 rounded-full bg-emerald-500 animate-pulse",title:t("workouts.in_progress")}),e.jsx("span",{className:"text-emerald-500 font-mono font-bold text-sm tracking-tighter",children:y})]})]}),e.jsx("div",{className:"flex gap-2 text-sm",children:e.jsx("span",{className:"text-neutral-600 dark:text-neutral-400 bg-neutral-100 dark:bg-neutral-800 px-2 py-0.5 rounded-full w-fit",children:l.focus})})]})}),e.jsxs("div",{className:"flex items-center gap-2 relative",ref:u,children:[e.jsxs(m,{size:"icon",className:"h-10 w-10 bg-emerald-600 hover:bg-emerald-700 text-white rounded-full shadow-md shadow-emerald-900/20",onClick:b,children:[e.jsx(V,{className:"h-4 w-4 ml-0.5"}),e.jsx("span",{className:"sr-only",children:t("workouts.start_workout")})]}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{variant:"ghost",size:"icon",className:$("h-8 w-8 text-neutral-400 hover:text-neutral-900 dark:hover:text-white transition-colors",p&&"text-neutral-900 dark:text-white bg-neutral-100 dark:bg-neutral-800"),onClick:r=>{r.preventDefault(),c(!p)},children:e.jsx(Y,{className:"h-4 w-4"})}),p&&e.jsxs("div",{className:"absolute right-0 bottom-full mb-2 w-48 bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-xl shadow-xl z-50 overflow-hidden animate-in fade-in slide-in-from-bottom-2 duration-200",children:[s&&e.jsxs("button",{className:"flex items-center gap-2 w-full p-3 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors",onClick:()=>{h({isOpen:!0,type:"cancel"}),c(!1)},children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{children:t("workouts.cancel_active","Cancel Workout")})]}),e.jsxs(w,{to:`/workout/${l.id}/edit`,className:"flex items-center gap-2 w-full p-3 text-sm text-neutral-700 dark:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors",onClick:()=>c(!1),children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{children:t("workouts.edit")})]}),e.jsxs("button",{className:"flex items-center gap-2 w-full p-3 text-sm text-neutral-700 dark:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors",onClick:()=>{h({isOpen:!0,type:"archive"}),c(!1)},children:[e.jsx(Q,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{children:t("workouts.archive")})]}),e.jsxs("button",{className:"flex items-center gap-2 w-full p-3 text-sm text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors border-t border-neutral-100 dark:border-neutral-700/50",onClick:()=>{h({isOpen:!0,type:"delete"}),c(!1)},children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:t("common.delete")})]})]})]})]}),e.jsx(Z,{isOpen:a.isOpen,onClose:()=>h({isOpen:!1,type:null}),onConfirm:()=>{a.type==="archive"&&j(l.id),a.type==="delete"&&v(l.id),a.type==="cancel"&&k()},variant:a.type==="delete"||a.type==="cancel"?"danger":"warning",title:a.type==="archive"?t("workouts.archive_title"):a.type==="delete"?t("workouts.delete_title"):t("workouts.cancel_active_title"),description:a.type==="archive"?t("workouts.archive_desc"):a.type==="delete"?t("workouts.delete_desc_full"):t("workouts.cancel_active_desc"),confirmLabel:a.type==="archive"?t("workouts.archive_confirm"):a.type==="delete"?t("common.delete"):t("workouts.cancel_active_confirm")})]})}function he(){var L,M,E,T,D;const l=H(),{t:s}=A(),{user:t}=B(),{workouts:x,fetchWorkouts:p,createWorkout:c,lastSession:a,isLoading:h}=_(),{currentSession:u,resumeSession:j,duration:v,hasNotifiedLongWorkout:N,setHasNotifiedLongWorkout:k}=C(),[y,f]=i.useState(!1),[b,r]=i.useState(""),[o,g]=i.useState(""),[S,W]=i.useState(""),[O,z]=i.useState(!1);i.useEffect(()=>{p(),j()},[p,j]);const F=async n=>{if(n.preventDefault(),!b||!o)return;z(!0);const I=await c(b,o,S);I&&l(`workout/${I}/edit`),z(!1),f(!1),r(""),g(""),W("")};return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-neutral-950 pb-20 transition-colors",children:[e.jsxs("header",{className:"p-4 flex items-center justify-between sticky top-0 bg-white/80 dark:bg-neutral-950/80 backdrop-blur-md z-10 border-b border-neutral-200 dark:border-neutral-800",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-neutral-900 dark:text-white",children:s("home.greeting",{name:((L=t==null?void 0:t.user_metadata)==null?void 0:L.full_name)||((M=t==null?void 0:t.email)==null?void 0:M.split("@")[0])})}),e.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:s("home.ready")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{to:"/history",children:e.jsx(m,{size:"icon",variant:"ghost",className:"rounded-full text-neutral-500 dark:text-neutral-400 hover:text-emerald-500 hover:bg-emerald-500/10",children:e.jsx(ee,{className:"h-5 w-5"})})}),e.jsx(w,{to:"/profile",children:e.jsx(m,{size:"icon",variant:"ghost",className:"rounded-full",children:e.jsx("div",{className:"h-8 w-8 bg-neutral-100 dark:bg-neutral-800 rounded-full flex items-center justify-center text-sm font-semibold text-neutral-900 dark:text-neutral-50 transition-colors",children:(((T=(E=t==null?void 0:t.user_metadata)==null?void 0:E.full_name)==null?void 0:T[0])||((D=t==null?void 0:t.email)==null?void 0:D[0])||"?").toUpperCase()})})})]})]}),e.jsxs("main",{className:"p-4 space-y-6",children:[h&&!a?e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{className:"h-4 w-32 px-1"}),e.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl p-4 flex items-center gap-4",children:[e.jsx(d,{className:"h-12 w-12 rounded-xl"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(d,{className:"h-4 w-3/4"}),e.jsx(d,{className:"h-3 w-1/2"})]})]})]}):a&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-bold text-neutral-400 dark:text-neutral-500 uppercase tracking-wider px-1",children:s("home.last_activity")}),e.jsx("div",{className:"bg-emerald-500/5 border border-emerald-500/10 rounded-2xl p-4 flex items-center justify-between transition-all",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 bg-emerald-500/20 rounded-xl flex items-center justify-center text-emerald-500",children:e.jsx(te,{className:"h-6 w-6 fill-current opacity-80"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:e.jsxs(K,{i18nKey:"home.last_activity_text",values:{workout:a.workout_name_snapshot},children:["You trained ",e.jsx("span",{className:"text-emerald-500 font-semibold",children:a.workout_name_snapshot})]})}),e.jsxs("p",{className:"text-xs text-neutral-400 dark:text-neutral-600 mt-0.5",children:[a.workout_focus_snapshot," â€¢ ",s("home.duration",{minutes:Math.round((a.duration_seconds||0)/60)})]})]})]})})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"text-lg font-semibold text-neutral-900 dark:text-white",children:s("home.workouts")})}),h&&x.length===0?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(n=>e.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl p-4 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{className:"h-6 w-32"}),e.jsx(d,{className:"h-8 w-8 rounded-full"})]}),e.jsx(d,{className:"h-4 w-24"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{className:"h-4 w-12 rounded-full"}),e.jsx(d,{className:"h-4 w-12 rounded-full"})]})]},n))}):x.length===0?e.jsxs("div",{className:"text-center py-10 border border-dashed border-neutral-200 dark:border-neutral-800 rounded-xl",children:[e.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 mb-4",children:s("home.no_workouts")}),e.jsx(m,{variant:"outline",onClick:()=>f(!0),children:s("home.create_first")})]}):e.jsx("div",{className:"space-y-3",children:x.map(n=>e.jsx(ae,{workout:n,isActive:(u==null?void 0:u.workout_id)===n.id},n.id))})]}),e.jsx(m,{onClick:()=>f(!0),size:"icon",className:"fixed bottom-6 right-6 h-14 w-14 rounded-full shadow-2xl bg-emerald-600 hover:bg-emerald-700 hover:scale-110 active:scale-95 transition-all text-white border-none z-50 ring-offset-white dark:ring-offset-neutral-950 shadow-emerald-500/20",children:e.jsx(se,{className:"h-7 w-7"})}),e.jsx(P,{isOpen:y,onClose:()=>f(!1),title:s("home.create_modal_title"),children:e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-neutral-900 dark:text-neutral-200",children:s("common.name")}),e.jsx(q,{value:b,onChange:n=>r(n.target.value),placeholder:s("common.name"),required:!0,className:"bg-neutral-50 dark:bg-neutral-900 border-neutral-200 dark:border-neutral-800 text-neutral-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-neutral-900 dark:text-neutral-200",children:s("home.focus")}),e.jsx(q,{value:o,onChange:n=>g(n.target.value),placeholder:s("home.focus"),required:!0,className:"bg-neutral-50 dark:bg-neutral-900 border-neutral-200 dark:border-neutral-800 text-neutral-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1 text-neutral-900 dark:text-neutral-200",children:[s("common.notes")," (",s("common.optional"),")"]}),e.jsx("textarea",{className:"flex w-full rounded-md border border-neutral-200 dark:border-neutral-800 bg-neutral-50 dark:bg-neutral-900 px-3 py-2 text-sm ring-offset-white dark:ring-offset-neutral-950 placeholder:text-neutral-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 text-neutral-900 dark:text-neutral-50 h-20 resize-none",value:S,onChange:n=>W(n.target.value),placeholder:s("home.notes_placeholder")})]}),e.jsx("div",{className:"pt-2",children:e.jsx(m,{type:"submit",className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white",disabled:O,children:s(O?"common.loading":"common.create")})})]})}),e.jsx(P,{isOpen:!!u&&v>=3600&&!N,onClose:()=>k(!0),title:s("session.long_workout_notification"),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:s("session.long_workout_modal_desc")}),e.jsx(m,{className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white",onClick:()=>k(!0),children:s("common.save")})]})})]})}export{he as default};
