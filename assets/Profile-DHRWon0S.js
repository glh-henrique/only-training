import{r as l,j as e}from"./vendor-RJ-jBvc8.js";import{b as xe,d as he,u as fe,c as J,s as n}from"./index-DfMx629v.js";import{B as m}from"./button-D3CWm_we.js";import{I as L}from"./input-PBOW6J0D.js";import{A as pe,M as be}from"./alert-modal-C606l9RK.js";import{u as ge}from"./i18n-DvSS2Fqm.js";import{h as je,M as Ne,l as ve,m as Q,n as ke,A as we,U as ye,K as _e,o as Se,p as Ce,q as qe,r as Pe,L as Le}from"./icons-CewslWSu.js";import{u as Oe}from"./router-Db51iocS.js";import"./supabase-BfAM1BYj.js";function We(){var K,V,H;const{t,i18n:b}=ge(),f=Oe(),{user:s,signOut:X,role:u,refreshProfileContext:Y}=xe(),{theme:N,toggleTheme:Z}=he(),{archivedCount:ee,fetchWorkouts:O}=fe(),[R,te]=l.useState(!1),[I,A]=l.useState(!1),[p,E]=l.useState(null),[v,U]=l.useState(null),[se,k]=l.useState(null),[ae,F]=l.useState(!1),[G,M]=l.useState(!1),[x,z]=l.useState(!1),[h,T]=l.useState(!1),[re,w]=l.useState(!1),[y,_]=l.useState(""),[S,C]=l.useState(""),[g,q]=l.useState(""),[le,W]=l.useState(""),[ne,B]=l.useState(""),[ie,D]=l.useState("");l.useEffect(()=>{O()},[O]),l.useEffect(()=>{(async()=>{if(!(!s||u!=="aluno")){F(!0);try{const{data:r}=await n.from("coach_student_links").select("*").eq("student_id",s.id).eq("status","active").maybeSingle();if(E(r||null),!r){U(null),k(null);return}const[{data:i},{data:o}]=await Promise.all([n.from("profiles").select("*").eq("user_id",r.coach_id).maybeSingle(),n.from("coach_student_unlink_requests").select("*").eq("link_id",r.id).eq("status","pending").maybeSingle()]);U(i||null),k(o||null)}finally{F(!1)}}})()},[s,u]),l.useEffect(()=>{(async()=>{if(s){z(!0);try{const{data:r}=await n.from("profiles").select("*").eq("user_id",s.id).maybeSingle(),i=(r==null?void 0:r.first_name)??"",o=(r==null?void 0:r.last_name)??"",d=(r==null?void 0:r.gym_name)??"";_(i),C(o),q(d),W(i),B(o),D(d)}finally{z(!1)}}})()},[s]);const[j,c]=l.useState({isOpen:!1,title:"",description:"",variant:"info"}),oe=async()=>{await X(),f("/login")},ce=async()=>{if(s!=null&&s.email){A(!0);try{const{error:a}=await n.auth.resetPasswordForEmail(s.email,{redirectTo:`${window.location.origin}/#/login`});if(a)throw a;c({isOpen:!0,variant:"success",title:t("profile.reset_email_sent_title"),description:t("profile.reset_email_sent_desc")}),te(!0)}catch(a){c({isOpen:!0,variant:"danger",title:t("profile.reset_error_title"),description:a.message})}finally{A(!1)}}},de=!!(s!=null&&s.email_confirmed_at),P=[y.trim(),S.trim()].filter(Boolean).join(" ").trim()||((K=s==null?void 0:s.user_metadata)==null?void 0:K.full_name)||((V=s==null?void 0:s.email)==null?void 0:V.split("@")[0])||"",me=async()=>{if(p){M(!0);try{const{data:a,error:r}=await n.rpc("request_student_unlink",{link_id_input:p.id});if(r)throw r;a==="ended"?(await Y(),c({isOpen:!0,variant:"success",title:t("coach.student.unlinked_title"),description:t("coach.student.unlinked_desc")})):c({isOpen:!0,variant:"info",title:t("coach.student.unlink_requested_title"),description:t("coach.student.unlink_requested_desc")});const{data:i}=await n.from("coach_student_links").select("*").eq("id",p.id).maybeSingle();E(i||null);const{data:o}=await n.from("coach_student_unlink_requests").select("*").eq("link_id",p.id).eq("status","pending").maybeSingle();k(o||null)}catch(a){c({isOpen:!0,variant:"danger",title:t("coach.student.unlink_error_title"),description:a.message})}finally{M(!1)}}},ue=async()=>{if(!s)return;const a=y.trim()||null,r=S.trim()||null,i=g.trim()||null,o=[a,r].filter(Boolean).join(" ").trim()||null;T(!0);try{const{error:d}=await n.from("profiles").upsert({user_id:s.id,role:u,first_name:a,last_name:r,gym_name:i,full_name:o},{onConflict:"user_id"});if(d)throw d;await n.auth.updateUser({data:{full_name:o}}),c({isOpen:!0,variant:"success",title:t("profile.profile_saved_title"),description:t("profile.profile_saved_desc")}),W(a??""),B(r??""),D(i??""),w(!1)}catch(d){c({isOpen:!0,variant:"danger",title:t("profile.profile_error_title"),description:d.message})}finally{T(!1)}},$=()=>{_(le),C(ne),q(ie),w(!1)};return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-neutral-950 text-neutral-900 dark:text-white pb-20",children:[e.jsxs("header",{className:"p-4 flex items-center gap-4 sticky top-0 bg-white/80 dark:bg-neutral-950/80 backdrop-blur-md z-10 border-b border-neutral-200 dark:border-neutral-800",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>f("/"),children:e.jsx(je,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-xl font-bold",children:t("profile.title")})]}),e.jsxs("main",{className:"p-4 space-y-8 max-w-lg mx-auto",children:[e.jsxs("section",{className:"flex flex-col items-center py-6 space-y-4",children:[e.jsx("div",{className:"h-24 w-24 bg-emerald-500 rounded-full flex items-center justify-center text-4xl font-bold text-white shadow-xl shadow-emerald-500/20",children:(P[0]||((H=s==null?void 0:s.email)==null?void 0:H[0])||"?").toUpperCase()}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:P}),e.jsxs("p",{className:"text-neutral-500 dark:text-neutral-400 flex items-center justify-center gap-1.5 mt-1",children:[e.jsx(Ne,{className:"h-4 w-4"}),s==null?void 0:s.email]})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-neutral-400 dark:text-neutral-500 uppercase tracking-wider px-1",children:t("profile.account")}),e.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-800",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-base font-semibold text-neutral-900 dark:text-neutral-100",children:P}),g.trim()?e.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:t("profile.training_at",{gym:g.trim()})}):null]}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>w(!0),disabled:x,className:"h-8 px-2 text-neutral-600 dark:text-neutral-300",children:[e.jsx(ve,{className:"h-4 w-4 mr-1.5"}),t("common.edit")]})]})}),e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-neutral-200 dark:border-neutral-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-blue-500/10 text-blue-500 rounded-xl flex items-center justify-center",children:e.jsx(Q,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:t("profile.verification_status")}),e.jsx("p",{className:"text-xs text-neutral-500",children:t("profile.verification_desc")})]})]}),de?e.jsxs("span",{className:"flex items-center gap-1 text-xs font-bold text-emerald-500 bg-emerald-500/10 px-2.5 py-1 rounded-full",children:[e.jsx(Q,{className:"h-3 w-3"}),t("profile.verified")]}):e.jsxs("span",{className:"flex items-center gap-1 text-xs font-bold text-amber-500 bg-amber-500/10 px-2.5 py-1 rounded-full",children:[e.jsx(ke,{className:"h-3 w-3"}),t("profile.not_verified")]})]}),e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-neutral-200 dark:border-neutral-800",children:[e.jsx("p",{className:"font-semibold",children:t("profile.account_type")}),e.jsx("span",{className:"text-xs font-bold text-emerald-500 bg-emerald-500/10 px-2.5 py-1 rounded-full",children:t(u==="instrutor"?"auth.register.role_instructor":"auth.register.role_student")})]}),e.jsx("button",{onClick:()=>f("/archive"),className:"w-full p-4 flex items-center justify-between hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors border-t border-neutral-200 dark:border-neutral-800 group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-amber-500/10 text-amber-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform",children:e.jsx(we,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold",children:t("workouts.archived","Archived Workouts")}),e.jsx("p",{className:"text-xs text-neutral-500",children:t("workouts.count",{count:ee})})]})]})}),u==="instrutor"&&e.jsx("button",{onClick:()=>f("/coach-panel"),className:"w-full p-4 flex items-center justify-between hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors border-t border-neutral-200 dark:border-neutral-800 group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-emerald-500/10 text-emerald-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform",children:e.jsx(ye,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold",children:t("coach.panel.title")}),e.jsx("p",{className:"text-xs text-neutral-500",children:t("coach.panel.subtitle")})]})]})})]})]}),u==="aluno"&&e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-neutral-400 dark:text-neutral-500 uppercase tracking-wider px-1",children:t("coach.student.section_title")}),e.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl p-4 space-y-3",children:ae?e.jsx("p",{className:"text-sm text-neutral-500",children:t("common.loading")}):p?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:(v==null?void 0:v.full_name)||t("coach.student.coach_unknown")}),e.jsx("p",{className:"text-xs text-neutral-500",children:t("coach.student.active_link")})]}),se?e.jsx("p",{className:"text-xs text-amber-500",children:t("coach.student.pending_unlink_request")}):e.jsx(m,{variant:"outline",size:"sm",onClick:me,disabled:G,children:t(G?"common.loading":"coach.student.request_unlink")})]})}):e.jsx("p",{className:"text-sm text-neutral-500",children:t("coach.student.no_coach")})})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-neutral-400 dark:text-neutral-500 uppercase tracking-wider px-1",children:t("profile.security")}),e.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-amber-500/10 text-amber-500 rounded-xl flex items-center justify-center",children:e.jsx(_e,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:t("profile.password_label")}),e.jsx("p",{className:"text-xs text-neutral-500",children:t("profile.password_desc")})]})]}),e.jsx(m,{variant:"outline",size:"sm",onClick:ce,disabled:I||R,className:"text-xs",children:t(R?"profile.reset_password_sent":I?"common.loading":"profile.reset_password")})]})})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-neutral-400 dark:text-neutral-500 uppercase tracking-wider px-1",children:t("profile.system")}),e.jsxs("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>Z(),type:"button",className:"w-full p-4 flex items-center justify-between hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors cursor-pointer group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-purple-500/10 text-purple-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform",children:N==="dark"?e.jsx(Se,{className:"h-5 w-5 fill-current"}):e.jsx(Ce,{className:"h-5 w-5"})}),e.jsx("div",{className:"text-left",children:e.jsx("p",{className:"font-semibold text-neutral-900 dark:text-white",children:t("profile.theme")})})]}),e.jsx("div",{className:`h-6 w-11 rounded-full relative p-1 transition-colors ${N==="dark"?"bg-emerald-600":"bg-neutral-300"}`,children:e.jsx("div",{className:`h-4 w-4 bg-white rounded-full shadow-sm transform transition-transform duration-200 ${N==="dark"?"translate-x-5":"translate-x-0"}`})})]}),e.jsxs("div",{className:"p-4 flex items-center justify-between border-t border-neutral-200 dark:border-neutral-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-emerald-500/10 text-emerald-500 rounded-xl flex items-center justify-center",children:e.jsx(qe,{className:"h-5 w-5"})}),e.jsx("div",{children:e.jsx("p",{className:"font-semibold",children:t("profile.language")})})]}),e.jsxs("div",{className:"flex bg-neutral-100 dark:bg-neutral-800 p-1 rounded-lg border border-neutral-200 dark:border-neutral-700",children:[e.jsx("button",{onClick:()=>b.changeLanguage("en"),className:J("px-3 py-1 text-xs font-semibold rounded-md transition-all",b.language.startsWith("en")?"bg-white dark:bg-neutral-700 text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300"),children:"EN"}),e.jsx("button",{onClick:()=>b.changeLanguage("pt"),className:J("px-3 py-1 text-xs font-semibold rounded-md transition-all",b.language.startsWith("pt")?"bg-white dark:bg-neutral-700 text-emerald-600 shadow-sm":"text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300"),children:"PT"})]})]})]})]}),e.jsx("section",{className:"space-y-4",children:e.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden",children:e.jsx("button",{onClick:()=>f("/about"),className:"w-full p-4 flex items-center justify-between hover:bg-neutral-100 dark:hover:bg-white/5 transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-sky-500/10 text-sky-500 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform",children:e.jsx(Pe,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold",children:t("about.title")}),e.jsx("p",{className:"text-xs text-neutral-500",children:t("about.short")})]})]})})})}),e.jsx("section",{className:"pt-4",children:e.jsxs(m,{variant:"ghost",className:"w-full py-6 text-red-500 hover:text-red-600 hover:bg-red-500/10 rounded-2xl flex items-center justify-center gap-2 font-bold",onClick:oe,children:[e.jsx(Le,{className:"h-5 w-5"}),t("common.logout")]})})]}),e.jsx(pe,{isOpen:j.isOpen,onClose:()=>c(a=>({...a,isOpen:!1})),title:j.title,description:j.description,variant:j.variant}),e.jsx(be,{isOpen:re,onClose:$,title:t("common.edit"),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-200",children:t("profile.first_name")}),e.jsx(L,{value:y,onChange:a=>_(a.target.value),placeholder:t("profile.first_name"),disabled:x||h})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-200",children:t("profile.last_name")}),e.jsx(L,{value:S,onChange:a=>C(a.target.value),placeholder:t("profile.last_name"),disabled:x||h})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-200",children:t("profile.gym_name")}),e.jsx(L,{value:g,onChange:a=>q(a.target.value),placeholder:t("profile.gym_placeholder"),disabled:x||h})]}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx(m,{variant:"outline",onClick:$,disabled:x||h,className:"flex-1",children:t("common.cancel")}),e.jsx(m,{onClick:ue,disabled:x||h,className:"flex-1",children:t(h?"common.loading":"common.save")})]})]})})]})}export{We as default};
